import{c,o as u,r as $,a as l,b as mt,d as ke,e as f,w as ie,f as A,v as pe,T as qe,g as q,h as O,n as Ce,i as _,t as v,F as x,j as P,k as M,l as ft,_ as yt,m as S,p as N,u as bt,q as X,s as It,x as He,y as St,z as J,A as se,B as Ot,C as Ct,D as T,E as Ee,G as Et,H as wt}from"./index-3j6Ei78Q.js";function we(t){return t===0?!1:Array.isArray(t)&&t.length===0?!0:!t}function Dt(t){return(...a)=>!t(...a)}function kt(t,a){return t===void 0&&(t="undefined"),t===null&&(t="null"),t===!1&&(t="false"),t.toString().toLowerCase().indexOf(a.trim())!==-1}function Nt(t){return t.filter(a=>!a.$isLabel)}function De(t,a){return n=>n.reduce((b,y)=>y[t]&&y[t].length?(b.push({$groupLabel:y[a],$isLabel:!0}),b.concat(y[t])):b,[])}const Ge=(...t)=>a=>t.reduce((n,b)=>b(n),a);var xt={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(t,a){return we(t)?"":a?t[a]:t}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||this.modelValue===0?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const t=this.search||"",a=t.toLowerCase().trim();let n=this.options.concat();return this.internalSearch?n=this.groupValues?this.filterAndFlat(n,a,this.label):this.filterOptions(n,a,this.label,this.customLabel):n=this.groupValues?De(this.groupValues,this.groupLabel)(n):n,n=this.hideSelected?n.filter(Dt(this.isSelected)):n,this.taggable&&a.length&&!this.isExistingOption(a)&&(this.tagPosition==="bottom"?n.push({isTag:!0,label:t}):n.unshift({isTag:!0,label:t})),n.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map(t=>t[this.trackBy]):this.internalValue},optionKeys(){return(this.groupValues?this.flatAndStrip(this.options):this.options).map(a=>this.customLabel(a,this.label).toString().toLowerCase())},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:this.internalValue.length===0?null:this.internalValue[0]},filterAndFlat(t,a,n){return Ge(this.filterGroups(a,n,this.groupValues,this.groupLabel,this.customLabel),De(this.groupValues,this.groupLabel))(t)},flatAndStrip(t){return Ge(De(this.groupValues,this.groupLabel),Nt)(t)},updateSearch(t){this.search=t},isExistingOption(t){return this.options?this.optionKeys.indexOf(t)>-1:!1},isSelected(t){const a=this.trackBy?t[this.trackBy]:t;return this.valueKeys.indexOf(a)>-1},isOptionDisabled(t){return!!t.$isDisabled},getOptionLabel(t){if(we(t))return"";if(t.isTag)return t.label;if(t.$isLabel)return t.$groupLabel;const a=this.customLabel(t,this.label);return we(a)?"":a},select(t,a){if(t.$isLabel&&this.groupSelect){this.selectGroup(t);return}if(!(this.blockKeys.indexOf(a)!==-1||this.disabled||t.$isDisabled||t.$isLabel)&&!(this.max&&this.multiple&&this.internalValue.length===this.max)&&!(a==="Tab"&&!this.pointerDirty)){if(t.isTag)this.$emit("tag",t.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{if(this.isSelected(t)){a!=="Tab"&&this.removeElement(t);return}this.multiple?this.$emit("update:modelValue",this.internalValue.concat([t])):this.$emit("update:modelValue",t),this.$emit("select",t,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(t){const a=this.options.find(n=>n[this.groupLabel]===t.$groupLabel);if(a){if(this.wholeGroupSelected(a)){this.$emit("remove",a[this.groupValues],this.id);const n=this.trackBy?a[this.groupValues].map(y=>y[this.trackBy]):a[this.groupValues],b=this.internalValue.filter(y=>n.indexOf(this.trackBy?y[this.trackBy]:y)===-1);this.$emit("update:modelValue",b)}else{const n=a[this.groupValues].filter(b=>!(this.isOptionDisabled(b)||this.isSelected(b)));this.max&&n.splice(this.max-this.internalValue.length),this.$emit("select",n,this.id),this.$emit("update:modelValue",this.internalValue.concat(n))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(t){return t[this.groupValues].every(a=>this.isSelected(a)||this.isOptionDisabled(a))},wholeGroupDisabled(t){return t[this.groupValues].every(this.isOptionDisabled)},removeElement(t,a=!0){if(this.disabled||t.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1){this.deactivate();return}const n=typeof t=="object"?this.valueKeys.indexOf(t[this.trackBy]):this.valueKeys.indexOf(t);if(this.multiple){const b=this.internalValue.slice(0,n).concat(this.internalValue.slice(n+1));this.$emit("update:modelValue",b)}else this.$emit("update:modelValue",null);this.$emit("remove",t,this.id),this.closeOnSelect&&a&&this.deactivate()},removeLastElement(){this.blockKeys.indexOf("Delete")===-1&&this.search.length===0&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&this.pointer===0&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick(()=>this.$refs.search&&this.$refs.search.focus())):this.preventAutofocus||typeof this.$el<"u"&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?this.$refs.search!==null&&typeof this.$refs.search<"u"&&this.$refs.search.blur():typeof this.$el<"u"&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if(typeof window>"u")return;const t=this.$el.getBoundingClientRect().top,a=window.innerHeight-this.$el.getBoundingClientRect().bottom;a>this.maxHeight||a>t||this.openDirection==="below"||this.openDirection==="bottom"?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(a-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(t-40,this.maxHeight))},filterOptions(t,a,n,b){return a?t.filter(y=>kt(b(y,n),a)).sort((y,p)=>typeof this.filteringSortFunc=="function"?this.filteringSortFunc(y,p):b(y,n).length-b(p,n).length):t},filterGroups(t,a,n,b,y){return p=>p.map(o=>{if(!o[n])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];const E=this.filterOptions(o[n],t,a,y);return E.length?{[b]:o[b],[n]:E}:[]})}}},At={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(t,a){return{"multiselect__option--highlight":t===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(a)}},groupHighlight(t,a){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":a.$isLabel}];const n=this.options.find(b=>b[this.groupLabel]===a.$groupLabel);return n&&!this.wholeGroupDisabled(n)?["multiselect__option--group",{"multiselect__option--highlight":t===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(n)}]:"multiselect__option--disabled"},addPointerElement({key:t}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],t),this.pointerReset()},pointerForward(){this.pointer<this.filteredOptions.length-1&&(this.pointer++,this.$refs.list?.scrollTop<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){this.pointer>0?(this.pointer--,this.$refs.list?.scrollTop>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(t){this.pointer=t,this.pointerDirty=!0}}},ze={name:"vue-multiselect",mixins:[xt,At],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:t=>`and ${t} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1},useTeleport:{type:Boolean,default:!1}},data(){return{dropdownStyles:{},ready:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||this.singleValue===0)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return this.openDirection==="above"||this.openDirection==="top"?!0:this.openDirection==="below"||this.openDirection==="bottom"?!1:this.preferredOpenDirection==="above"},showSearchInput(){return this.searchable&&(this.hasSingleSelectedSlot&&(this.visibleSingleValue||this.visibleSingleValue===0)?this.isOpen:!0)},isRequired(){return this.required===!1?!1:this.internalValue.length<=0}},watch:{isOpen(t){t&&(this.useTeleport?(this.ready=!1,this.$nextTick(()=>{const a=this.$el.getBoundingClientRect();this.dropdownStyles={position:"absolute",top:`${a.bottom+window.scrollY}px`,left:`${a.left+window.scrollX}px`,width:`${a.width}px`,zIndex:9999},this.ready=!0})):this.ready=!0)}}};const Lt=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],Vt={ref:"tags",class:"multiselect__tags"},$t={class:"multiselect__tags-wrap"},Rt=["textContent"],Mt=["onKeypress","onMousedown"],_t=["textContent"],Tt={class:"multiselect__spinner"},Bt=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],Ut=["id","aria-multiselectable"],Pt={key:0},Ft={class:"multiselect__option"},qt=["aria-selected","id","role"],Ht=["onClick","onMouseenter","data-select","data-selected","data-deselect"],Gt=["data-select","data-deselect","onMouseenter","onMousedown"],zt={class:"multiselect__option"},jt={class:"multiselect__option"};function Kt(t,a,n,b,y,p){return u(),c("div",{tabindex:t.searchable?-1:n.tabindex,class:M([{"multiselect--active":t.isOpen,"multiselect--disabled":n.disabled,"multiselect--above":p.isAbove,"multiselect--has-options-group":p.hasOptionGroup},"multiselect"]),onFocus:a[14]||(a[14]=o=>t.activate()),onBlur:a[15]||(a[15]=o=>t.searchable?!1:t.deactivate()),onKeydown:[a[16]||(a[16]=q(O(o=>t.pointerForward(),["self","prevent"]),["down"])),a[17]||(a[17]=q(O(o=>t.pointerBackward(),["self","prevent"]),["up"]))],onKeypress:a[18]||(a[18]=q(O(o=>t.addPointerElement(o),["stop","self"]),["enter","tab"])),onKeyup:a[19]||(a[19]=q(o=>t.deactivate(),["esc"])),role:"combobox","aria-expanded":t.isOpen,"aria-owns":"listbox-"+t.id,"aria-activedescendant":t.isOpen&&t.pointer!==null?t.id+"-"+t.pointer:null},[$(t.$slots,"caret",{toggle:t.toggle},()=>[l("div",{onMousedown:a[0]||(a[0]=O(o=>t.toggle(),["prevent","stop"])),class:"multiselect__select"},null,32)]),$(t.$slots,"clear",{search:t.search}),l("div",Vt,[$(t.$slots,"selection",{search:t.search,remove:t.removeElement,values:p.visibleValues,isOpen:t.isOpen},()=>[A(l("div",$t,[(u(!0),c(x,null,P(p.visibleValues,(o,E)=>$(t.$slots,"tag",{option:o,search:t.search,remove:t.removeElement},()=>[(u(),c("span",{class:"multiselect__tag",key:E,onMousedown:a[1]||(a[1]=O(()=>{},["prevent"]))},[l("span",{textContent:v(t.getOptionLabel(o))},null,8,Rt),l("i",{tabindex:"1",onKeypress:q(O(B=>t.removeElement(o),["prevent"]),["enter"]),onMousedown:O(B=>t.removeElement(o),["prevent"]),class:"multiselect__tag-icon"},null,40,Mt)],32))])),256))],512),[[pe,p.visibleValues.length>0]]),t.internalValue&&t.internalValue.length>n.limit?$(t.$slots,"limit",{key:0},()=>[l("strong",{class:"multiselect__strong",textContent:v(n.limitText(t.internalValue.length-n.limit))},null,8,_t)]):f("v-if",!0)]),ke(qe,{name:"multiselect__loading"},{default:ie(()=>[$(t.$slots,"loading",{},()=>[A(l("div",Tt,null,512),[[pe,n.loading]])])]),_:3}),t.searchable?(u(),c("input",{key:0,ref:"search",name:n.name,id:t.id,type:"text",autocomplete:"off",spellcheck:n.spellcheck,placeholder:t.placeholder,required:p.isRequired,style:Ce(p.inputStyle),value:t.search,disabled:n.disabled,tabindex:n.tabindex,"aria-label":n.name+"-searchbox",onInput:a[2]||(a[2]=o=>t.updateSearch(o.target.value)),onFocus:a[3]||(a[3]=O(o=>t.activate(),["prevent"])),onBlur:a[4]||(a[4]=O(o=>t.deactivate(),["prevent"])),onKeyup:a[5]||(a[5]=q(o=>t.deactivate(),["esc"])),onKeydown:[a[6]||(a[6]=q(O(o=>t.pointerForward(),["prevent"]),["down"])),a[7]||(a[7]=q(O(o=>t.pointerBackward(),["prevent"]),["up"])),a[9]||(a[9]=q(O(o=>t.removeLastElement(),["stop"]),["delete"]))],onKeypress:a[8]||(a[8]=q(O(o=>t.addPointerElement(o),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+t.id},null,44,Bt)):f("v-if",!0),p.isSingleLabelVisible?(u(),c("span",{key:1,class:"multiselect__single",onMousedown:a[10]||(a[10]=O((...o)=>t.toggle&&t.toggle(...o),["prevent"]))},[$(t.$slots,"singleLabel",{option:p.singleValue},()=>[_(v(t.currentOptionLabel),1)])],32)):f("v-if",!0),p.isPlaceholderVisible?(u(),c("span",{key:2,class:"multiselect__placeholder",onMousedown:a[11]||(a[11]=O((...o)=>t.toggle&&t.toggle(...o),["prevent"]))},[$(t.$slots,"placeholder",{},()=>[_(v(t.placeholder),1)])],32)):f("v-if",!0)],512),(u(),mt(ft,{to:"body",disabled:!n.useTeleport},[ke(qe,{name:"multiselect"},{default:ie(()=>[t.isOpen&&y.ready?(u(),c("div",{key:0,class:"multiselect__content-wrapper",onFocus:a[12]||(a[12]=(...o)=>t.activate&&t.activate(...o)),tabindex:"-1",onMousedown:a[13]||(a[13]=O(()=>{},["prevent"])),style:Ce([y.dropdownStyles,{maxHeight:t.optimizedHeight+"px"}]),ref:"list"},[l("ul",{class:"multiselect__content",style:Ce(p.contentStyle),role:"listbox",id:"listbox-"+t.id,"aria-multiselectable":t.multiple},[$(t.$slots,"beforeList"),t.multiple&&t.max===t.internalValue.length?(u(),c("li",Pt,[l("span",Ft,[$(t.$slots,"maxElements",{},()=>[_("Maximum of "+v(t.max)+" options selected. First remove a selected option to select another.",1)])])])):f("v-if",!0),!t.max||t.internalValue.length<t.max?(u(!0),c(x,{key:1},P(t.filteredOptions,(o,E)=>(u(),c("li",{class:"multiselect__element",key:E,"aria-selected":t.isSelected(o),id:t.id+"-"+E,role:o&&(o.$isLabel||o.$isDisabled)?null:"option"},[o&&(o.$isLabel||o.$isDisabled)?f("v-if",!0):(u(),c("span",{key:0,class:M([t.optionHighlight(E,o),"multiselect__option"]),onClick:O(B=>t.select(o),["stop"]),onMouseenter:O(B=>t.pointerSet(E),["self"]),"data-select":o&&o.isTag?t.tagPlaceholder:p.selectLabelText,"data-selected":p.selectedLabelText,"data-deselect":p.deselectLabelText},[$(t.$slots,"option",{option:o,search:t.search,index:E},()=>[l("span",null,v(t.getOptionLabel(o)),1)])],42,Ht)),o&&(o.$isLabel||o.$isDisabled)?(u(),c("span",{key:1,"data-select":t.groupSelect&&p.selectGroupLabelText,"data-deselect":t.groupSelect&&p.deselectGroupLabelText,class:M([t.groupHighlight(E,o),"multiselect__option"]),onMouseenter:O(B=>t.groupSelect&&t.pointerSet(E),["self"]),onMousedown:O(B=>t.selectGroup(o),["prevent"])},[$(t.$slots,"option",{option:o,search:t.search,index:E},()=>[l("span",null,v(t.getOptionLabel(o)),1)])],42,Gt)):f("v-if",!0)],8,qt))),128)):f("v-if",!0),A(l("li",null,[l("span",zt,[$(t.$slots,"noResult",{search:t.search},()=>[a[20]||(a[20]=_("No elements found. Consider changing the search query."))])])],512),[[pe,n.showNoResults&&t.filteredOptions.length===0&&t.search&&!n.loading]]),A(l("li",null,[l("span",jt,[$(t.$slots,"noOptions",{},()=>[a[21]||(a[21]=_("List is empty."))])])],512),[[pe,n.showNoOptions&&(t.options.length===0||p.hasOptionGroup===!0&&t.filteredOptions.length===0)&&!t.search&&!n.loading]]),$(t.$slots,"afterList")],12,Ut)],36)):f("v-if",!0)]),_:3})],8,["disabled"]))],42,Lt)}ze.render=Kt;const Zt={class:"min-h-screen bg-slate-50"},Xt={class:"sticky top-0 z-10 backdrop-blur bg-white/70 border-b border-slate-200"},Yt={class:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"},Qt={class:"text-slate-900 font-semibold text-lg sm:text-2xl"},Jt={class:"max-w-6xl mx-auto px-2 sm:px-4 py-6 space-y-4"},Wt={key:0,class:"text-center py-12 text-brand-700 font-semibold"},es={key:1,class:"text-center py-12 text-red-500"},ts={class:"card mb-3"},ss={class:"card-body grid grid-cols-1 sm:grid-cols-6 gap-3 sm:items-end"},is=["disabled"],ls={key:0,value:"all"},as=["value"],ns={class:"sm:col-span-3"},os=["value"],rs={key:0,class:"text-xs text-slate-500 mt-1"},us={class:"card"},ds={class:"card-body"},cs={class:"grid grid-cols-1 sm:grid-cols-6 gap-2 sm:items-end"},ps=["value"],hs={class:"flex items-center gap-2 mt-2 sm:mt-0"},vs={class:"mt-4 flex flex-wrap gap-2"},gs={class:"card"},ms={class:"card-body overflow-x-auto p-0"},fs={class:"table min-w-full text-xs sm:text-sm"},ys={key:0},bs={key:1},Is={key:2,class:"text-center"},Ss={class:"font-medium text-slate-900"},Os={key:0},Cs={class:"text-slate-700"},Es={key:1},ws={class:"text-slate-700"},Ds={key:2,class:"text-slate-300"},ks=["title"],Ns={key:2,class:"text-right"},xs=["onClick"],As={key:3,class:"text-right"},Ls=["onClick"],Vs={key:0},$s=["colspan"],Rs={class:"bg-white rounded-xl shadow max-w-2xl w-full"},Ms={class:"p-4 border-b flex items-center justify-between"},_s={class:"font-semibold text-slate-800"},Ts={class:"p-4 space-y-4"},Bs={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Us=["value"],Ps={key:0,class:"sm:col-span-2"},Fs={class:"flex items-center justify-between w-full"},qs={class:"text-xs text-slate-400"},Hs={key:1},Gs={key:2},zs={key:3},js={key:4,class:"sm:col-span-3"},Ks={key:5,class:"sm:col-span-3 text-xs text-slate-500"},Zs={class:"flex justify-end gap-2 pt-2"},Xs=["disabled"],Ys={key:0,class:"fixed inset-0 z-[9998] grid place-items-center p-4"},Qs={class:"relative z-10 w-full max-w-5xl rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-200"},Js={class:"px-5 py-4 rounded-t-2xl text-white flex items-center justify-between bg-gradient-to-r from-slate-900 via-indigo-700 to-blue-600 dark:from-slate-950 dark:via-indigo-900 dark:to-blue-800"},Ws={class:"flex items-center gap-3"},ei={class:"text-xl font-semibold tracking-tight"},ti={key:0,class:"opacity-80 text-sm"},si={class:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs bg-white/15 text-white"},ii={class:"px-5 py-3 flex flex-wrap items-center gap-3"},li={class:"flex items-center gap-2"},ai={class:"inline-flex items-center gap-1 rounded-full border border-slate-300 bg-white px-3 py-1 text-xs text-slate-700 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-700"},ni={class:"ml-auto inline-flex rounded-full p-1 bg-slate-200/70 dark:bg-slate-700/60"},oi={class:"px-5 pb-5 max-h-[70vh] overflow-auto"},ri={key:0},ui={class:"grid grid-cols-7 gap-2"},di=["title"],ci={class:"text-[11px] font-medium opacity-60"},pi={key:0,class:"mt-auto text-center text-lg leading-none"},hi={key:1,class:"text-[11px] text-center truncate mt-1 opacity-85"},vi={key:1,class:"space-y-4 relative"},gi={class:"opacity-70"},mi={class:"opacity-70"},fi={key:2,class:"mt-5 flex flex-wrap gap-2 text-xs"},yi={__name:"AdminReportDetail",setup(t){const a=S([]);async function n(){try{const{data:i}=await T.get("/admin/groups",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});a.value=Array.isArray(i)?i:[]}catch{a.value=[]}}const b=N(()=>B.value&&B.value.role==="leader_group"),y=S("all"),p=bt(),o=St(),E={id:11001,name:"BOGOTÁ, D.C.",dept:"BOGOTÁ, D.C.",label(){return`${this.name} (${this.dept})`}},B=S(null);async function je(){try{const{data:i}=await T.get("/me",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});B.value=i}catch{B.value=null}}const W=N(()=>{const i=String(B.value?.role||"").toLowerCase();return["leader_group","superadmin","supervision","supervisor"].includes(i)}),Ne=N(()=>p.params.id?String(p.params.id):null),he=N(()=>p.query.date?String(p.query.date):new Date().toISOString().slice(0,10)),L=N(()=>p.query.groupId?String(p.query.groupId):null),V=N(()=>!!L.value),ve=S(!0),F=S({groupCode:"",unitName:"",date:"—"}),R=S(!1),G=S([]),xe=S([]),D=S({...{q:"",category:"ALL",state:"ALL",unitId:"ALL",onlyNovelties:!1}}),Ae=["SIN NOVEDAD","SERVICIO","COMISIÓN DEL SERVICIO","FRANCO FRANCO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","COMISIÓN EN EL EXTERIOR","COMISIÓN DE ESTUDIO","SUSPENDIDO","HOSPITALIZADO"],w=S(he.value),k=S(String(p.query.unitId||"")),z=S([]);function Y(){const i=new Date,s=String(i.getMonth()+1).padStart(2,"0"),e=String(i.getDate()).padStart(2,"0");return`${i.getFullYear()}-${s}-${e}`}async function le(i){try{const s={date_from:i,date_to:i};V.value&&L.value&&(s.groupId=L.value);const{data:e}=await T.get("/dashboard/reports",{params:s,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),d=Array.isArray(e?.items)?e.items:[],g=new Map;for(const r of d)if(r.unitId&&r.unitName){const C=String(r.unitId);g.has(C)||g.set(C,{id:C,name:r.unitName})}z.value=Array.from(g.values()).sort((r,C)=>String(r.name||"").localeCompare(String(C.name||"")));const m=String(p.query.unitId||"");if(m){if(k.value=m,!z.value.some(r=>String(r.id)===m))try{const{data:r}=await T.get(`/admin/units/${m}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});r?.id?z.value.unshift({id:String(r.id),name:r.name||`Unidad ${r.id}`}):z.value.unshift({id:m,name:`Unidad ${m}`})}catch{z.value.unshift({id:m,name:`Unidad ${m}`})}}else k.value=""}catch(s){console.error("loadUnitsIndex error",s),z.value=[]}}async function ee(i,s){try{const e=String(s??"").trim(),d=/^\d+$/.test(e)?Number(e):e,g={date_from:i,date_to:i,unitId:d};V.value&&L.value&&(g.groupId=L.value);const{data:m}=await T.get("/dashboard/reports",{params:g,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let r=Array.isArray(m?.items)?m.items:[];if(r.length&&(r=r.filter(I=>String(I.unitId)===String(d))),!r.length){await o.replace({name:p.name,params:p.params,query:{...p.query,unitId:String(d||""),date:i}});return}const C=r.sort((I,te)=>String(I.id).localeCompare(String(te.id))).pop();await o.replace({name:p.name,params:{id:String(C.id)},query:{...p.query,unitId:String(d),date:i}}),R.value=!1,G.value=[],await me(String(C.id)),F.value={...F.value,date:i},R.value=!0}catch(e){console.warn("gotoReportForUnit error:",e?.message||e),await o.replace({name:p.name,params:p.params,query:{...p.query,unitId:String(s||""),date:i}})}}async function Ke(){const i=w.value||Y();await le(i),k.value?await ee(i,k.value):(V.value&&L.value&&await Q(i,L.value),await o.replace({name:p.name,params:p.params,query:{...p.query,date:i,unitId:""}}),F.value={...F.value,date:i})}async function Le(){const i=w.value||Y(),s=k.value;if(!s){V.value&&L.value&&await Q(i,L.value),await o.replace({name:p.name,params:p.params,query:{...p.query,date:i,unitId:""}});return}await ee(i,s)}X(()=>p.query,async i=>{const s=String(i.date||Y()),e=String(i.unitId||"");(s!==w.value||e!==k.value)&&(w.value=s,k.value=e,await le(s),e?await ee(s,e):V.value&&L.value&&await Q(s,L.value))});function ge(i){if(!i)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(i)){const[m,r,C]=i.split("-");return`${C}/${r}/${m}`}const s=new Date(i);if(isNaN(s))return"";const e=String(s.getDate()).padStart(2,"0"),d=String(s.getMonth()+1).padStart(2,"0"),g=s.getFullYear();return`${e}/${d}/${g}`}function Ze(i){return String(i||"").toUpperCase()==="SO"?"ME":i}const Xe={OF:1,SO:2,PT:3};function Ve(i){const s=String(i||"").toUpperCase();return Xe[s]||99}function Ye(i){const s=String(i||"").toUpperCase();return s==="SIN NOVEDAD"?"bg-green-50 text-green-700 border-green-200":s==="SERVICIO"||s==="COMISIÓN DEL SERVICIO"?"bg-sky-50 text-sky-700 border-sky-200":"bg-amber-50 text-amber-800 border-amber-200"}async function me(i){const{data:s}=await T.get(`/admin/report-agents/${i}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),e=r=>({...r,_key:`${r.code}-${r.unitName||""}-${r.state}-${r.novelty_start||""}-${r.novelty_end||""}`,municipality:r.municipalityName&&r.dept?`${r.municipalityName} (${r.dept})`:r.municipalityName||"",municipalityName:r.municipalityName||null,municipalityDept:r.dept||null,municipalityId:r.municipalityId!=null?Number(r.municipalityId):null,novelty_description:r.novelty_description||r.descripcion,reportId:i}),d=(Array.isArray(s)?s:[]).map(e);G.value=d;const g=d[0],m=w.value||he.value;F.value={groupCode:g?.groupCode||"",unitName:g?.unitName||"",date:m},R.value=!0,await $e()}async function Q(i,s){const{data:e}=await T.get("/dashboard/reports",{params:{date_from:i,date_to:i,groupId:s},headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),d=Array.isArray(e?.items)?e.items:[];if(!d.length){R.value=!1;return}F.value={groupCode:d[0].groupCode,unitName:"",date:i},xe.value=[...new Map(d.map(m=>[String(m.unitName||""),{id:m.unitId,name:m.unitName}])).values()].filter(m=>!!m.id).sort((m,r)=>(m.name||"").localeCompare(r.name||""));const g=[];for(const m of d){const{data:r}=await T.get(`/admin/report-agents/${m.id}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),C=(Array.isArray(r)?r:[]).map(I=>({...I,_key:`${I.code}-${I.unitName||""}-${I.state}-${I.novelty_start||""}-${I.novelty_end||""}`,municipality:I.municipalityName&&I.dept?`${I.municipalityName} (${I.dept})`:I.municipalityName||"",municipalityName:I.municipalityName||null,municipalityDept:I.dept||null,municipalityId:I.municipalityId!=null?Number(I.municipalityId):null,novelty_description:I.novelty_description||I.descripcion,reportId:m.id}));g.push(...C)}G.value=g,R.value=!0,await $e()}function Qe(i){const s=["SIN NOVEDAD","SERVICIO","COMISIÓN DEL SERVICIO"];let e=0;for(let d=i.length-1;d>=0;d--){const g=String(i[d]?.state||"").toUpperCase();if(s.includes(g))e++;else break}return e}async function $e(){for(const i of G.value)try{const{data:s}=await T.get(`/admin/agents/${i.agentId||i.id}/history`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{from:"2020-01-01",to:Y()}}),e=Array.isArray(s?.items)?s.items:[];i.diasLaborados=Qe(e)}catch{i.diasLaborados=0}}const ae=N(()=>{let i=G.value.slice();const s=D.value.q.trim().toUpperCase();if(s&&(i=i.filter(e=>String(e.code||"").toUpperCase().includes(s)||String(e.novelty_description||"").toUpperCase().includes(s)||String(e.unitName||"").toUpperCase().includes(s))),D.value.category!=="ALL"&&(i=i.filter(e=>String(e.category)===D.value.category)),D.value.state!=="ALL"&&(i=i.filter(e=>String(e.state).toUpperCase()===D.value.state)),D.value.onlyNovelties&&(i=i.filter(e=>String(e.state).toUpperCase()!=="SIN NOVEDAD")),V.value&&D.value.unitId!=="ALL"){const e=xe.value.find(d=>String(d.id)===String(D.value.unitId))?.name||"";i=i.filter(d=>String(d.unitName||"")===e)}return i.sort((e,d)=>{const g=Ve(e.category),m=Ve(d.category);return g!==m?g-m:String(e.code).localeCompare(String(d.code))})}),Je=N(()=>{const i={"SIN NOVEDAD":0,SERVICIO:0,"COMISIÓN DEL SERVICIO":0,otros:0};for(const s of ae.value){const e=String(s.state).toUpperCase();e==="SIN NOVEDAD"?i["SIN NOVEDAD"]++:e==="SERVICIO"?i.SERVICIO++:e==="COMISIÓN DEL SERVICIO"?i["COMISIÓN DEL SERVICIO"]++:i.otros++}return[{key:"sn",label:"Sin novedad",count:i["SIN NOVEDAD"],cls:"bg-green-50 text-green-700 border-green-200",dot:"bg-green-600"},{key:"srv",label:"Servicio",count:i.SERVICIO,cls:"bg-sky-50 text-sky-700 border-sky-200",dot:"bg-sky-600"},{key:"cds",label:"Comisión del servicio",count:i["COMISIÓN DEL SERVICIO"],cls:"bg-sky-50 text-sky-700 border-sky-200",dot:"bg-sky-600"},{key:"oth",label:"Otros",count:i.otros,cls:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-600"}]}),fe=S(!1),j=S(null),ne=S(!1),h=S({state:"SIN NOVEDAD",municipio:null,novelty_start:"",novelty_end:"",novelty_description:""}),ye=N(()=>["SERVICIO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","COMISIÓN EN EL EXTERIOR","COMISIÓN DE ESTUDIO","SUSPENDIDO"].includes(h.value.state)),Re=N(()=>["SERVICIO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","COMISIÓN EN EL EXTERIOR","COMISIÓN DE ESTUDIO","COMISIÓN DEL SERVICIO","SUSPENDIDO","HOSPITALIZADO"].includes(h.value.state)),We=N(()=>h.value.state==="COMISIÓN DEL SERVICIO");function et(i){if(!W.value)return;j.value=i;const s=String(i.state||"").toUpperCase(),e=s==="COMISIÓN DEL SERVICIO";let d=null;if(e){const g=i.municipalityId!=null?Number(i.municipalityId):null,m=i.municipalityName||null,r=i.municipalityDept||null;g&&(d=Me(g,m,r))}h.value={state:s,municipio:d,novelty_start:i.novelty_start||"",novelty_end:i.novelty_end||"",novelty_description:i.novelty_description||""},fe.value=!0}X(()=>h.value.state,i=>{if(String(i||"").toUpperCase()!=="COMISIÓN DEL SERVICIO")h.value.municipio=null;else{const e=j.value;e?.municipalityId&&!h.value.municipio&&(h.value.municipio=Me(e.municipalityId,e.municipalityName,e.municipalityDept))}});function oe(){fe.value=!1,j.value=null}const K=S([]),be=S(!1);let Ie=null;async function tt(i){Ie&&clearTimeout(Ie),Ie=setTimeout(async()=>{const s=String(i||"").trim();if(s.length<2){K.value=[];return}be.value=!0;try{const{data:e}=await T.get("/catalogs/municipalities",{params:{q:s,limit:15},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});K.value=(e||[]).map(d=>({id:d.id,label:`${d.name} (${d.dept})`}))}catch{K.value=[]}finally{be.value=!1}},250)}function Me(i,s,e){if(!i)return null;const d=Number(i);let g=K.value.find(m=>Number(m.id)===d);return g||(g={id:d,label:s?`${s} (${e||""})`:`id ${d}`},K.value=[g,...K.value]),g}async function st(){if(j.value){if(h.value.state==="COMISIÓN DEL SERVICIO"&&!h.value.municipio?.id){alert("Selecciona un municipio para Comisión del servicio");return}if(h.value.state==="COMISIÓN DEL SERVICIO"&&!h.value.novelty_description?.trim()){alert("La descripción es requerida para Comisión del servicio");return}if(h.value.state==="HOSPITALIZADO"){if(!h.value.novelty_start){alert("Falta fecha de inicio (HOSPITALIZADO)");return}if(!h.value.novelty_description?.trim()){alert("Falta descripción (HOSPITALIZADO)");return}}if(ye.value&&(!h.value.novelty_start||!h.value.novelty_end)){alert("Completa las fechas de la novedad (inicio y fin)");return}if(Re.value&&!h.value.novelty_description?.trim()){alert("La descripción es requerida para este estado");return}ne.value=!0;try{const i=h.value.state==="HOSPITALIZADO";await T.put(`/admin/report-agents/${j.value.reportId}/${j.value.agentId}`,{state:h.value.state,municipalityId:h.value.state==="COMISIÓN DEL SERVICIO"?h.value.municipio?.id||null:["SERVICIO","SIN NOVEDAD"].includes(h.value.state)?E.id:null,novelty_start:h.value.novelty_start||null,novelty_end:i?null:h.value.novelty_end||null,novelty_description:h.value.novelty_description||null},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let s=null,e=null,d=null,g="";if(h.value.state==="COMISIÓN DEL SERVICIO"){if(s=h.value.municipio?.id||null,h.value.municipio?.label){const m=h.value.municipio.label.split(" (");e=m[0]||null,d=m[1]?m[1].replace(/\)$/,""):null,g=h.value.municipio.label}}else["SERVICIO","SIN NOVEDAD"].includes(h.value.state)&&(s=E.id,e=E.name,d=E.dept,g=E.label());Object.assign(j.value,{state:h.value.state,municipalityId:s,municipalityName:e,municipalityDept:d,municipality:g||(e?`${e} (${d||""})`:"N/A"),novelty_start:h.value.novelty_start||null,novelty_end:i?null:h.value.novelty_end||null,novelty_description:h.value.novelty_description||null}),oe()}catch(i){alert(i?.response?.data?.detail||i?.response?.data?.error||"No se pudo guardar")}finally{ne.value=!1}}}async function it(){const i=ae.value.map(g=>({codigo:g.code,categoria:g.category,unidad:g.unitName||"",estado:g.state,ubicacion:g.municipality||"",descripcion:g.novelty_description||"",fecha_inicio:g.novelty_start?String(g.novelty_start).slice(0,10):"",fecha_fin:g.novelty_end?String(g.novelty_end).slice(0,10):""})),s=Ee.json_to_sheet(i),e=Ee.book_new();Ee.book_append_sheet(e,s,"Detalle");const d=Et(e,{bookType:"xlsx",type:"array"});wt.saveAs(new Blob([d],{type:"application/octet-stream"}),`detalle_${F.value.groupCode}_${F.value.date}.xlsx`)}It(async()=>{ve.value=!0,await je(),await n();const i=p.query.groupId?String(p.query.groupId):b.value&&a.value[0]?String(a.value[0].id):"all";y.value=i;try{const s=String(p.query.date||""),e=String(p.query.unitId||"");w.value=s||he.value,k.value=e,await le(w.value),k.value&&w.value?await ee(w.value,k.value):V.value&&L.value?await Q(w.value,L.value):Ne.value?(await me(Ne.value),F.value={...F.value,date:w.value}):R.value=!1,b.value&&a.value.length&&(y.value=String(a.value[0].id))}catch{R.value=!1}finally{ve.value=!1}}),X(()=>p.params.id,async(i,s)=>{if(i&&i!==s){R.value=!1,G.value=[];try{await me(String(i))}finally{R.value=!0}}}),X(k,async(i,s)=>{i!==s&&await Le()}),X(()=>p.query.unitId,async(i,s)=>{if(i!==s){const e=String(p.query.date||w.value);k.value=String(i||""),k.value?await ee(e,k.value):V.value&&L.value&&(R.value=!1,G.value=[],await Q(e,L.value),R.value=!0)}}),X(y,async(i,s)=>{i!==s&&(await o.replace({name:p.name,params:p.params,query:{...p.query,groupId:i==="all"?void 0:i,unitId:""}}),await le(w.value),i!=="all"?await Q(w.value,i):(G.value=[],R.value=!1))}),X(()=>p.query.groupId,i=>{i&&String(y.value)!==String(i)&&(y.value=String(i)),!i&&y.value!=="all"&&(y.value="all")});const H=S({open:!1,agent:null}),Z=S("calendar"),re=S([]),U=S(new Date);function ue(i){return i.toISOString().slice(0,10)}function _e(i){const s=new Date(i);return s.setDate(1),s.setHours(0,0,0,0),s}function Te(i){const s=new Date(i);return s.setMonth(s.getMonth()+1,0),s.setHours(0,0,0,0),s}function Be(i,s){const e=new Date(i);return e.setMonth(e.getMonth()+s),e}function lt(i){return new Intl.DateTimeFormat("es-CO",{month:"long",year:"numeric"}).format(i)}function at(i){return(i.getDay()+6)%7}const Ue=N(()=>ue(_e(U.value))),Pe=N(()=>ue(Te(U.value))),nt=N(()=>lt(U.value));function ot(){U.value=Be(U.value,-1),ce()}function rt(){U.value=Be(U.value,1),ce()}function ut(){U.value=new Date((w.value||Y())+"T00:00:00"),ce()}function Se(i){const s=String(i||"").toUpperCase();return{"SIN NOVEDAD":"✅",SERVICIO:"🧭","COMISIÓN DEL SERVICIO":"📌","FRANCO FRANCO":"🛌",VACACIONES:"🏖️","LICENCIA DE MATERNIDAD":"👶","LICENCIA DE LUTO":"🕊️","LICENCIA REMUNERADA":"📝","LICENCIA NO REMUNERADA":"📝","EXCUSA DEL SERVICIO":"📝","LICENCIA PATERNIDAD":"🍼",PERMISO:"⏳","COMISIÓN EN EL EXTERIOR":"✈️","COMISIÓN DE ESTUDIO":"🎓",SUSPENDIDO:"⛔",HOSPITALIZADO:"🏥"}[s]||"•"}function de(i){const s=String(i||"").toUpperCase();return{"SIN NOVEDAD":{bg:"bg-emerald-100",pill:"bg-emerald-100 text-emerald-800",dot:"bg-emerald-500"},SERVICIO:{bg:"bg-sky-100",pill:"bg-sky-100 text-sky-800",dot:"bg-sky-500"},"COMISIÓN DEL SERVICIO":{bg:"bg-indigo-100",pill:"bg-indigo-100 text-indigo-800",dot:"bg-indigo-500"},"FRANCO FRANCO":{bg:"bg-gray-100",pill:"bg-gray-100 text-gray-800",dot:"bg-gray-500"},VACACIONES:{bg:"bg-amber-100",pill:"bg-amber-100 text-amber-800",dot:"bg-amber-500"},SUSPENDIDO:{bg:"bg-rose-100",pill:"bg-rose-100 text-rose-800",dot:"bg-rose-500"},HOSPITALIZADO:{bg:"bg-rose-100",pill:"bg-rose-100 text-rose-800",dot:"bg-rose-500"}}[s]||{bg:"bg-slate-100",pill:"bg-slate-100 text-slate-700",dot:"bg-slate-400"}}function Fe(i){return i=String(i||""),i.length<=16?i:i.slice(0,16)+"…"}const dt=["SIN NOVEDAD","SERVICIO","COMISIÓN DEL SERVICIO","VACACIONES","FRANCO FRANCO","SUSPENDIDO","HOSPITALIZADO"];async function ct(i){const s=i.agentId??i.id;s&&(H.value={open:!0,agent:{id:s,code:i.code,nickname:i.nickname}},Z.value="calendar",U.value=new Date((w.value||Y())+"T00:00:00"),await ce())}async function ce(){if(H.value.agent)try{const{data:i}=await T.get(`/admin/agents/${H.value.agent.id}/history`,{params:{from:Ue.value,to:Pe.value},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});re.value=Array.isArray(i?.items)?i.items:[]}catch(i){console.warn("No se pudo cargar historial:",i?.response?.data?.error||i.message),re.value=[]}}const pt=N(()=>{const i=_e(U.value),s=Te(U.value),e=at(i),d=s.getDate(),g=new Map(re.value.map(r=>[String(r.date),r])),m=[];for(let r=0;r<e;r++)m.push({key:"pad-"+r,day:"",state:null,title:""});for(let r=1;r<=d;r++){const C=new Date(i);C.setDate(r);const I=ue(C),te=g.get(I),Oe=te?.state||null,vt=Oe?`${I} — ${Oe}${te?.municipalityName?" — "+te.municipalityName:""}`:I,gt=I===ue(new Date);m.push({key:I,day:r,state:Oe,title:vt,isToday:gt})}for(;m.length%7;)m.push({key:"tail-"+m.length,day:"",state:null,title:""});return m}),ht=N(()=>{const i=[...re.value].sort((e,d)=>String(e.date).localeCompare(String(d.date))),s=[];for(const e of i){const d=e.state||"SIN NOVEDAD",g=String(d).toUpperCase()==="COMISIÓN DEL SERVICIO",m=g?e.municipalityName||"—":null,r=g?`${d}::${m}`:d,C=s[s.length-1];C&&C.key===r?(C.to=e.date,C.count+=1):s.push({key:r,state:d,municipalityName:m,from:e.date,to:e.date,count:1})}return s});return(i,s)=>(u(),c(x,null,[l("div",Zt,[l("header",Xt,[l("div",Yt,[l("h1",Qt,v(V.value?"Detalle de reporte del grupo":"Detalle de reporte de unidad"),1),l("button",{onClick:s[0]||(s[0]=e=>He(o).back()),class:"btn-ghost"},"Volver")])]),l("main",Jt,[ve.value?(u(),c("div",Wt,"Cargando...")):R.value?(u(),c(x,{key:2},[l("div",ts,[l("div",ss,[l("div",null,[s[18]||(s[18]=l("label",{class:"label"},"Fecha",-1)),A(l("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=e=>w.value=e),class:"input",onChange:Ke},null,544),[[J,w.value]])]),l("div",null,[s[19]||(s[19]=l("label",{class:"label"},"Grupo",-1)),A(l("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>y.value=e),class:"input",disabled:b.value},[b.value?f("",!0):(u(),c("option",ls,"Todos")),(u(!0),c(x,null,P(a.value,e=>(u(),c("option",{key:e.id,value:String(e.id)},v(e.code)+" ("+v(e.name)+") ",9,as))),128))],8,is),[[se,y.value]])]),l("div",ns,[s[21]||(s[21]=l("label",{class:"label"},"Unidad",-1)),A(l("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>k.value=e),class:"input",onChange:Le},[s[20]||(s[20]=l("option",{value:""},"Todas las unidades…",-1)),(u(!0),c(x,null,P(z.value,e=>(u(),c("option",{key:e.id,value:String(e.id)},v(e.name),9,os))),128))],544),[[se,k.value]]),z.value.length?f("",!0):(u(),c("p",rs," No hay unidades para la fecha seleccionada. "))])])]),l("div",us,[l("div",ds,[l("div",cs,[l("div",null,[s[22]||(s[22]=l("label",{class:"label"},"Búsqueda",-1)),A(l("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>D.value.q=e),class:"input",placeholder:"Código o texto…"},null,512),[[J,D.value.q]])]),l("div",null,[s[24]||(s[24]=l("label",{class:"label"},"Categoría",-1)),A(l("select",{"onUpdate:modelValue":s[5]||(s[5]=e=>D.value.category=e),class:"input"},s[23]||(s[23]=[l("option",{value:"ALL"},"Todas",-1),l("option",{value:"OF"},"OF",-1),l("option",{value:"SO"},"ME",-1),l("option",{value:"PT"},"PT",-1)]),512),[[se,D.value.category]])]),l("div",null,[s[26]||(s[26]=l("label",{class:"label"},"Estado",-1)),A(l("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>D.value.state=e),class:"input"},[s[25]||(s[25]=l("option",{value:"ALL"},"Todos",-1)),(u(),c(x,null,P(Ae,e=>l("option",{key:e,value:e},v(e),9,ps)),64))],512),[[se,D.value.state]])]),l("div",hs,[A(l("input",{id:"solo-nov",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=e=>D.value.onlyNovelties=e),class:"h-4 w-4"},null,512),[[Ot,D.value.onlyNovelties]]),s[27]||(s[27]=l("label",{class:"label cursor-pointer",for:"solo-nov"},"Solo novedades",-1))]),l("div",{class:"flex gap-2"},[l("button",{class:"flex-1 sm:flex-none inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700",onClick:it},"Descargar")])]),l("div",vs,[(u(!0),c(x,null,P(Je.value,e=>(u(),c("span",{key:e.key,class:M(["inline-flex items-center gap-2 px-3 py-1 rounded-full border text-sm",e.cls])},[l("span",{class:M(["inline-block w-2.5 h-2.5 rounded-full",e.dot])},null,2),_(" "+v(e.label)+": ",1),l("b",null,v(e.count),1)],2))),128))])])]),l("div",gs,[l("div",ms,[l("table",fs,[l("thead",null,[l("tr",null,[s[28]||(s[28]=l("th",null,"Código",-1)),s[29]||(s[29]=l("th",null,"Agente",-1)),s[30]||(s[30]=l("th",null,"Cat",-1)),V.value?(u(),c("th",ys,"Grupo")):f("",!0),V.value?(u(),c("th",bs,"Unidad")):f("",!0),s[31]||(s[31]=l("th",null,"Novedad",-1)),s[32]||(s[32]=l("th",null,"Ubicación",-1)),s[33]||(s[33]=l("th",null,"Descripción",-1)),s[34]||(s[34]=l("th",null,"Inicio - Fin",-1)),s[35]||(s[35]=l("th",null,"Días Lab",-1)),s[36]||(s[36]=l("th",null,"Historial",-1)),W.value?(u(),c("th",Is,"Acciones")):f("",!0)])]),l("tbody",null,[(u(!0),c(x,null,P(ae.value,e=>(u(),c("tr",{key:e._key},[l("td",Ss,v(e.code),1),l("td",null,v(e.nickname||"—"),1),l("td",null,v(Ze(e.category)),1),V.value?(u(),c("td",Os,[l("span",Cs,v(e.groupCode||"—"),1)])):f("",!0),V.value?(u(),c("td",Es,[l("span",ws,v(e.unitName||"—"),1)])):f("",!0),l("td",null,[l("span",{class:M(["inline-flex px-2 py-0.5 rounded-full text-xs font-semibold border",Ye(e.state)])},v(e.state),3)]),l("td",null,v(e.municipality||"N/A"),1),l("td",null,v(e.novelty_description||"—"),1),l("td",null,[e.novelty_start&&e.novelty_end?(u(),c(x,{key:0},[_(v(ge(e.novelty_start))+" – "+v(ge(e.novelty_end)),1)],64)):e.novelty_start?(u(),c(x,{key:1},[_(v(ge(e.novelty_start)),1)],64)):(u(),c("span",Ds,"—"))]),l("td",null,[l("span",{class:M(["inline-block min-w-[2.5em] text-center rounded px-1",e.diasLaborados>=45?"bg-red-100 text-red-600 font-bold border border-red-200":e.diasLaborados>=30?"bg-orange-100 text-orange-700 font-semibold border border-orange-200":e.diasLaborados>0?"bg-green-50 text-green-700 font-semibold border border-green-200":"text-slate-400 border border-slate-200 bg-white"]),title:e.diasLaborados>=45?"¡Alerta! tiempo prolongado sin descanso ":e.diasLaborados>=30?"Atención: Más de un mes sin descansar":e.diasLaborados>0?"Días consecutivos en servicio o sin novedad":"Sin días laborados"},v(e.diasLaborados??0),11,ks)]),W.value?(u(),c("td",Ns,[l("button",{class:"btn-ghost p-1",title:"Historial",onClick:d=>ct(e)},s[37]||(s[37]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M12 8v4l3 3"}),l("circle",{cx:"12",cy:"12",r:"9"})],-1)]),8,xs)])):f("",!0),W.value?(u(),c("td",As,[l("button",{class:"btn-ghost p-1",title:"Editar",onClick:d=>et(e)},s[38]||(s[38]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[l("path",{d:"M18 2a2.828 2.828 0 0 1 4 4L7 21l-4 1 1-4Z"}),l("path",{d:"m16 5 3 3"})],-1)]),8,Ls)])):f("",!0)]))),128)),ae.value.length?f("",!0):(u(),c("tr",Vs,[l("td",{colspan:W.value?V.value?8:7:V.value?7:6,class:"text-center text-slate-500 py-6"},"Sin agentes",8,$s)]))])])])]),fe.value?(u(),c("div",{key:0,class:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center p-4",onClick:O(oe,["self"])},[l("div",Rs,[l("div",Ms,[l("div",_s," Editar agente — "+v(j.value?.code),1),l("button",{class:"btn-ghost",onClick:oe},"Cerrar")]),l("div",Ts,[l("div",Bs,[l("div",null,[s[39]||(s[39]=l("label",{class:"label"},"Estado",-1)),A(l("select",{"onUpdate:modelValue":s[8]||(s[8]=e=>h.value.state=e),class:"input"},[(u(),c(x,null,P(Ae,e=>l("option",{key:e,value:e},v(e),9,Us)),64))],512),[[se,h.value.state]])]),We.value?(u(),c("div",Ps,[s[41]||(s[41]=l("label",{class:"label"},"Municipio",-1)),ke(He(ze),{modelValue:h.value.municipio,"onUpdate:modelValue":s[9]||(s[9]=e=>h.value.municipio=e),options:K.value,loading:be.value,"internal-search":!1,"clear-on-select":!0,"close-on-select":!0,"preserve-search":!0,"show-labels":!1,"allow-empty":!0,placeholder:"Escribe para buscar…",label:"label","track-by":"id",onSearchChange:tt,class:"w-full"},{noResult:ie(()=>s[40]||(s[40]=[_("Ningún municipio encontrado",-1)])),option:ie(({option:e})=>[l("div",Fs,[l("span",null,v(e.label),1),l("span",qs,"id: "+v(e.id),1)])]),singleLabel:ie(({option:e})=>[l("span",null,v(e.label),1)]),_:1},8,["modelValue","options","loading"]),s[42]||(s[42]=l("div",{class:"text-xs text-slate-500 mt-1"},null,-1))])):f("",!0),ye.value?(u(),c("div",Hs,[s[43]||(s[43]=l("label",{class:"label"},"Inicio",-1)),A(l("input",{"onUpdate:modelValue":s[10]||(s[10]=e=>h.value.novelty_start=e),type:"date",class:"input"},null,512),[[J,h.value.novelty_start]])])):f("",!0),ye.value?(u(),c("div",Gs,[s[44]||(s[44]=l("label",{class:"label"},"Fin",-1)),A(l("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>h.value.novelty_end=e),type:"date",class:"input"},null,512),[[J,h.value.novelty_end]])])):h.value.state==="HOSPITALIZADO"?(u(),c("div",zs,[s[45]||(s[45]=l("label",{class:"label"},"Inicio",-1)),A(l("input",{"onUpdate:modelValue":s[12]||(s[12]=e=>h.value.novelty_start=e),type:"date",class:"input"},null,512),[[J,h.value.novelty_start]])])):f("",!0),Re.value?(u(),c("div",js,[s[46]||(s[46]=l("label",{class:"label"},"Descripción",-1)),A(l("textarea",{"onUpdate:modelValue":s[13]||(s[13]=e=>h.value.novelty_description=e),class:"input",rows:"2",placeholder:"Motivo / detalle..."},null,512),[[J,h.value.novelty_description]])])):f("",!0),h.value.state==="SERVICIO"?(u(),c("div",Ks," Para “SERVICIO” el municipio se fija automáticamente en Bogotá (11001). ")):f("",!0)]),l("div",Zs,[l("button",{class:"btn-ghost",onClick:oe},"Cancelar"),l("button",{class:"btn-primary",onClick:st,disabled:ne.value},v(ne.value?"Guardando...":"Guardar"),9,Xs)])])])])):f("",!0)],64)):(u(),c("div",es,"No se encontró información para los parámetros."))])]),H.value.open?(u(),c("div",Ys,[l("div",{class:"absolute inset-0 bg-black/40",onClick:s[14]||(s[14]=e=>H.value.open=!1)}),l("div",Qs,[l("div",Js,[l("div",Ws,[l("div",ei,[_(" Historial — "+v(H.value.agent?.code)+" ",1),H.value.agent?.nickname?(u(),c("span",ti,"("+v(H.value.agent.nickname)+")",1)):f("",!0)]),l("span",si,v(nt.value),1)]),l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium text-white hover:bg-white/10",onClick:s[15]||(s[15]=e=>H.value.open=!1)},"✕")]),l("div",ii,[l("div",li,[l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:ot},"◀"),l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:ut},"Hoy"),l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:rt},"▶"),l("span",ai,v(Ue.value)+" → "+v(Pe.value),1)]),l("div",ni,[l("button",{class:M(["px-3 py-1.5 text-sm rounded-full",Z.value==="calendar"?"bg-white shadow-sm text-slate-900 dark:bg-slate-900 dark:text-white":"text-slate-700 dark:text-slate-200"]),onClick:s[16]||(s[16]=e=>Z.value="calendar")},"Calendario",2),l("button",{class:M(["px-3 py-1.5 text-sm rounded-full",Z.value==="timeline"?"bg-white shadow-sm text-slate-900 dark:bg-slate-900 dark:text-white":"text-slate-700 dark:text-slate-200"]),onClick:s[17]||(s[17]=e=>Z.value="timeline")},"Línea de tiempo",2)])]),l("div",oi,[Z.value==="calendar"?(u(),c("div",ri,[s[47]||(s[47]=Ct('<div class="grid grid-cols-7 gap-2 text-xs font-medium text-slate-600 mb-1" data-v-6dcfdb00><div class="text-center" data-v-6dcfdb00>L</div><div class="text-center" data-v-6dcfdb00>M</div><div class="text-center" data-v-6dcfdb00>X</div><div class="text-center" data-v-6dcfdb00>J</div><div class="text-center" data-v-6dcfdb00>V</div><div class="text-center" data-v-6dcfdb00>S</div><div class="text-center" data-v-6dcfdb00>D</div></div>',1)),l("div",ui,[(u(!0),c(x,null,P(pt.value,e=>(u(),c("div",{key:e.key,title:e.title,class:M(["h-20 rounded-xl p-2 flex flex-col transition-all border border-slate-200 dark:border-slate-700 hover:shadow-md hover:-translate-y-[1px]",[e.state?de(e.state)?.bg||"bg-slate-100":"bg-white dark:bg-slate-400/60",e.isToday&&"ring-2 ring-blue-500/70"]])},[l("div",ci,v(e.day||""),1),e.state?(u(),c("div",pi,v(Se(e.state)),1)):f("",!0),e.state?(u(),c("div",hi,v(Fe(e.state)),1)):f("",!0)],10,di))),128))])])):(u(),c("div",vi,[s[48]||(s[48]=l("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-gradient-to-b from-slate-300 via-slate-200 to-slate-300 dark:from-slate-700 dark:via-slate-800 dark:to-slate-700"},null,-1)),(u(!0),c(x,null,P(ht.value,(e,d)=>(u(),c("div",{key:d,class:"flex items-center gap-3 pl-4"},[l("div",{class:M(["w-3 h-3 rounded-full border-2 border-white shadow ring-1 ring-slate-200 dark:border-slate-900",de(e.state)?.dot||"bg-slate-400"])},null,2),l("div",{class:M(["inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs shadow-sm",de(e.state)?.pill||"bg-slate-100 text-slate-700"])},[_(v(Se(e.state))+" ",1),l("span",null,[_(v(e.state)+" ",1),e.municipalityName?(u(),c(x,{key:0},[_(" — 📍 "+v(e.municipalityName),1)],64)):f("",!0)]),l("span",gi,"("+v(e.from)+" → "+v(e.to)+")",1),l("span",mi,"• "+v(e.count)+" día(s)",1)],2)]))),128))])),Z.value==="calendar"?(u(),c("div",fi,[(u(),c(x,null,P(dt,e=>l("div",{key:e,class:M(["inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs shadow-sm",de(e)?.pill||"bg-slate-100 text-slate-700"])},v(Se(e))+" "+v(Fe(e)),3)),64))])):f("",!0)])])])):f("",!0)],64))}},Si=yt(yi,[["__scopeId","data-v-6dcfdb00"]]);export{Si as default};
