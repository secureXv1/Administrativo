import{_ as j,m as v,x as B,c as i,o as d,C as z,a as t,e as g,f as m,z as R,A as K,F as U,g as O,t as o,y as V,k as q,j as A,I as W}from"./index-qUi1pC3R.js";const F={class:"max-w-6xl mx-auto space-y-6"},M={class:"min-h-screen bg-slate-50"},X={class:"max-w-6xl mx-auto px-2 sm:px-4 py-6 space-y-4"},J={class:"card"},Q={class:"card-body grid grid-cols-1 sm:grid-cols-6 gap-3"},Y=["value"],Z={class:"sm:col-span-6 flex gap-2"},ee={class:"card"},te={class:"card-body p-0 overflow-x-auto"},ae={class:"table w-full"},ne={class:"align-top text-slate-700"},se={class:"align-top"},oe={class:"mr-1"},le={class:"align-top"},re={class:"text-slate-900"},ie={key:0,class:"mt-1"},de={class:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 ring-1 ring-slate-200"},ue={key:0,class:"opacity-70"},ce={key:1,class:"mt-1 flex flex-wrap gap-1.5"},ge={key:0,class:"inline-flex text-[11px] px-2 py-0.5 rounded-full bg-slate-50 text-slate-600 ring-1 ring-slate-200"},pe={key:1,class:"inline-flex text-[11px] px-2 py-0.5 rounded-full bg-slate-50 text-slate-600 ring-1 ring-slate-200"},_e={key:2,class:"inline-flex text-[11px] px-2 py-0.5 rounded-full bg-slate-50 text-slate-600 ring-1 ring-slate-200"},ve={key:2,class:"text-xs text-slate-500 mt-1"},be={class:"align-top"},Ee={class:"text-slate-900"},fe={class:"text-xs text-slate-500"},Ce={class:"align-top"},me={class:"align-top truncate max-w-[220px]"},Ae={class:"align-top text-right"},xe=["onClick"],$e={key:0},he={class:"p-3 flex items-center justify-between text-sm text-slate-600"},Re={class:"flex items-center gap-2"},ye=["disabled"],Te=["disabled"],Ie={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center p-4"},Ue={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full p-4"},Oe={class:"flex items-center justify-between mb-2"},Ne={class:"font-semibold"},Se={class:"text-xs bg-slate-50 rounded p-3 overflow-auto max-h-[60vh]"},De={__name:"AdminAuditLog",setup(we){const x=[{value:"",label:"Todas",icon:"â€¢"},{value:"LOGIN",label:"Inicio de sesiÃ³n",icon:"ðŸ”‘"},{value:"LOGOUT",label:"Cierre de sesiÃ³n",icon:"âŽ‹"},{value:"ACCOUNT_LOCK",label:"Bloqueo temporal",icon:"â³"},{value:"ACCOUNT_HARD_LOCK",label:"Bloqueo",icon:"ðŸ”’"},{value:"ACCOUNT_UNLOCK",label:"Desbloqueo de cuenta",icon:"ðŸ”“"},{value:"REPORT_CREATE",label:"Registro de reporte",icon:"ðŸ“"},{value:"REPORT_UPDATE",label:"EdiciÃ³n de reporte",icon:"âœï¸"},{value:"EXCEL_DOWNLOAD",label:"Descarga Excel",icon:"ðŸ“Š"},{value:"USER_CREATE",label:"CreaciÃ³n de usuario",icon:"ðŸ‘¤âž•"},{value:"USER_PASSWORD_CHANGE",label:"Cambio de contraseÃ±a",icon:"ðŸ”’"},{value:"USER_ROLE_CHANGE",label:"Cambio de rol",icon:"ðŸŽ›"},{value:"AGENT_CREATE",label:"CreaciÃ³n de agente",icon:"ðŸ§‘â€âœˆï¸âž•"},{value:"AGENT_UPDATE",label:"EdiciÃ³n de agente",icon:"ðŸ§‘â€âœˆï¸âœ"},{value:"GROUP_CREATE",label:"CreaciÃ³n de grupo",icon:"ðŸ§©"},{value:"UNIT_CREATE",label:"CreaciÃ³n de unidad",icon:"ðŸ·ï¸"},{value:"AGENT_ASSIGN",label:"AsignaciÃ³n de agente",icon:"ðŸ“¥"},{value:"AGENT_RELEASE",label:"LiberaciÃ³n de agente",icon:"ðŸ“¤"}],N=x.filter(n=>n.value).map(n=>n.value),u=v({from:"",to:"",action:"",username:""}),f=v([]),C=v(0),p=v(1),y=v(50),$=v(!1),b=v(null);function h(n){return x.find(e=>e.value===n)||x[0]}function S(n){switch(n){case"LOGIN":return"badge-green";case"LOGOUT":return"badge-slate";case"ACCOUNT_LOCK":return"badge-amber";case"ACCOUNT_HARD_LOCK":return"badge-red";case"ACCOUNT_UNLOCK":return"badge-lime";case"REPORT_CREATE":return"badge-blue";case"REPORT_UPDATE":return"badge-amber";case"EXCEL_DOWNLOAD":return"badge-emerald";case"USER_CREATE":return"badge-purple";case"USER_PASSWORD_CHANGE":return"badge-orange";case"USER_ROLE_CHANGE":return"badge-violet";case"AGENT_CREATE":return"badge-teal";case"AGENT_UPDATE":return"badge-cyan";case"GROUP_CREATE":return"badge-indigo";case"UNIT_CREATE":return"badge-indigo";case"AGENT_ASSIGN":return"badge-emerald";case"AGENT_RELEASE":return"badge-red";default:return"badge-slate"}}function D(n){return h(n).icon}function w(n){return!n&&n!==0?"â€”":(typeof n=="number"?new Date(n):new Date(String(n))).toLocaleString()}function L(n){try{return JSON.stringify(n||{},null,2)}catch{return String(n)}}function G(){u.value={from:"",to:"",action:"",username:""},E(1)}function k(n){b.value=n}function P(n){try{return typeof n=="string"?JSON.parse(n):n||null}catch{return null}}function r(n){return P(n?.details)}function H(n){const e=r(n)||{},a=n.username?`@${n.username}`:"usuario";switch(n.action){case"LOGIN":return`Inicio de sesiÃ³n de ${a}`;case"LOGOUT":return`Cierre de sesiÃ³n de ${a}`;case"ACCOUNT_LOCK":{const s=e.minutes?`${e.minutes} min`:e.lock_until?"hasta "+e.lock_until:"";return`Bloqueo temporal de ${e.targetUserId?`ID ${e.targetUserId}`:e.username?"@"+e.username:"cuenta"}${s?" Â· "+s:""}${e.reason?" Â· "+e.reason:""}`}case"ACCOUNT_HARD_LOCK":return`Bloqueo de ${e.targetUserId?`ID ${e.targetUserId}`:e.username?"@"+e.username:"cuenta"}${e.reason?" Â· "+e.reason:""}`;case"ACCOUNT_UNLOCK":return`Desbloqueo de ${e.username?`@${e.username}`:e.targetUserId?`ID ${e.targetUserId}`:"cuenta"}`;case"REPORT_CREATE":{const s=e.reportId?`#${e.reportId}`:"",l=e.reportDate||"",c=e.groupId!=null?`grupo ${e.groupId}`:"",_=e.unitId!=null?`unidad ${e.unitId}`:"",I=Array.isArray(e.agents)?e.agents.length:e.agentsCount??"";return`Registro de reporte ${[s,l,c,_,I?`${I} agentes`:""].filter(Boolean).join(" Â· ")}`}case"REPORT_UPDATE":{const s=e.reportId?`#${e.reportId}`:"",l=e.agentCode||e.code||"",c=e.state||e?.changes?.state,_=`ActualizÃ³ reporte ${s}${l?` para agente ${l}`:""}`;return c?`${_} Â· estado: ${c}`:_}case"EXCEL_DOWNLOAD":{const s=e.date||"",l=e.groupId!=null?`grupo ${e.groupId}`:"",c=e.unitId!=null?`unidad ${e.unitId}`:"",_=[s,l,c].filter(Boolean);return`DescargÃ³ Excel${_.length?" Â· "+_.join(" Â· "):""}`}case"USER_CREATE":return`CreÃ³ usuario ${e.username?"@"+e.username:"nuevo usuario"}${e.role?" Â· rol "+e.role:""}`;case"USER_PASSWORD_CHANGE":return`Cambio de contraseÃ±a de usuario${e.by?` (${e.by})`:""}`;case"USER_ROLE_CHANGE":return`Cambio de rol de usuario${e.oldRole||e.newRole?`: ${e.oldRole||"â€”"} â†’ ${e.newRole||"â€”"}`:""}`;case"AGENT_CREATE":return`CreÃ³ agente ${e.code||"sin cÃ³digo"}${e.category?" Â· "+e.category:""}`;case"AGENT_UPDATE":{const s=e?.changes?.code||e.code,l=e?.changes?Object.keys(e.changes).filter(c=>c!=="code"):[];return`EditÃ³ agente ${s||""}${l.length?` Â· campos: ${l.join(", ")}`:""}`}case"GROUP_CREATE":return`CreÃ³ grupo ${e.code||"nuevo"}`;case"UNIT_CREATE":return`CreÃ³ unidad ${e.name||"nueva"}${e.groupId!=null?" Â· grupo "+e.groupId:""}`;case"AGENT_ASSIGN":{const s=e.agentCode?` ${e.agentCode}`:"",l=e.toUnitId!=null?`unidad ${e.toUnitId}`:"unidad ?",c=e.mode?` (${e.mode})`:"";return`AsignÃ³ agente${s} a ${l}${c}`}case"AGENT_RELEASE":{const s=e.agentCode?` ${e.agentCode}`:"",l=e.fromUnitId!=null?`unidad ${e.fromUnitId}`:"unidad ?",c=e.mode?` (${e.mode})`:"";return`LiberÃ³ agente${s} de ${l}${c}`}default:return"Evento"}}function T(n){const e=r(n)||{};if(n.action==="REPORT_UPDATE"){const a=[];return e.municipalityId&&a.push(`municipio ${e.municipalityId}`),e.novelty_start&&a.push(`inicio ${e.novelty_start}`),e.novelty_end&&a.push(`fin ${e.novelty_end}`),e.novelty_description&&a.push(`"${String(e.novelty_description).slice(0,50)}${String(e.novelty_description).length>50?"â€¦":""}"`),a.join(" Â· ")||null}if(n.action==="AGENT_ASSIGN"||n.action==="AGENT_RELEASE"){const a=[];return e.fromGroupId!=null&&a.push(`grupo: ${e.fromGroupId} â†’ ${e.toGroupId??"â€”"}`),(e.fromUnitId!=null||e.toUnitId!=null)&&a.push(`unidad: ${e.fromUnitId??"â€”"} â†’ ${e.toUnitId??"â€”"}`),a.length?a.join(" Â· "):null}return null}async function E(n=1){$.value=!0,p.value=n;try{const e={page:p.value,pageSize:y.value};Object.entries(u.value).forEach(([s,l])=>{l!==""&&l!=null&&(e[s]=l)});const{data:a}=await W.get("/admin/audit",{params:e});f.value=a.items||[],C.value=a.total||0}catch(e){console.error("AUDIT LIST ERROR",e),f.value=[],C.value=0}finally{$.value=!1}}return B(()=>{const n=new Date,e=new Date(n);e.setDate(e.getDate()-6),u.value.from=e.toISOString().slice(0,10),u.value.to=n.toISOString().slice(0,10),E(1)}),(n,e)=>(d(),i("div",F,[e[18]||(e[18]=z('<div class="sticky top-0 z-10 bg-white/70 backdrop-blur border-b border-slate-200" data-v-ab670622><div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between" data-v-ab670622><div class="flex items-center gap-3" data-v-ab670622><div class="w-9 h-9 rounded-xl bg-gradient-to-br from-slate-800 to-slate-700 grid place-items-center text-white font-bold" data-v-ab670622>C</div><div data-v-ab670622><h2 class="font-semibold text-slate-900" data-v-ab670622>Log de Eventos</h2><p class="text-slate-500 text-xs" data-v-ab670622>Historial de eventos en el sistema.</p></div></div></div></div>',1)),t("div",M,[t("main",X,[t("div",J,[t("div",Q,[t("div",null,[e[8]||(e[8]=t("label",{class:"label"},"Desde",-1)),m(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=a=>u.value.from=a),class:"input"},null,512),[[R,u.value.from]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"label"},"Hasta",-1)),m(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>u.value.to=a),class:"input"},null,512),[[R,u.value.to]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"label"},"AcciÃ³n",-1)),m(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.action=a),class:"input"},[e[10]||(e[10]=t("option",{value:""},"Todas",-1)),(d(!0),i(U,null,O(V(N),a=>(d(),i("option",{key:a,value:a},o(a),9,Y))),128))],512),[[K,u.value.action]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"label"},"Usuario",-1)),m(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>u.value.username=a),class:"input",placeholder:"Usuario a buscar"},null,512),[[R,u.value.username]])]),t("div",Z,[t("button",{class:"btn-primary",onClick:e[4]||(e[4]=a=>E(1))},"Aplicar filtros"),t("button",{class:"btn-ghost",onClick:G},"Limpiar")])])]),t("div",ee,[t("div",te,[t("table",ae,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",{class:"whitespace-nowrap"},"Fecha/Hora"),t("th",null,"AcciÃ³n"),t("th",null,"Resumen"),t("th",null,"Usuario"),t("th",null,"IP"),t("th",{class:"whitespace-nowrap"},"User Agent"),t("th")])],-1)),t("tbody",null,[(d(!0),i(U,null,O(f.value,a=>(d(),i("tr",{key:a.id},[t("td",ne,o(w(a.created_at_ts??a.created_at)),1),t("td",se,[t("span",{class:q(["badge",S(a.action)])},[t("span",oe,o(D(a.action)),1),A(" "+o(h(a.action).label),1)],2)]),t("td",le,[t("div",re,o(H(a)),1),r(a)?.agentCode?(d(),i("div",ie,[t("span",de,[e[13]||(e[13]=t("svg",{class:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M10 10a4 4 0 100-8 4 4 0 000 8zm-7 8a7 7 0 1114 0H3z"})],-1)),A(" Agente: "+o(r(a).agentCode)+" ",1),r(a).agentCategory?(d(),i("span",ue,"Â· "+o(r(a).agentCategory),1)):g("",!0)])])):g("",!0),r(a)?.reportDate||r(a)?.groupId||r(a)?.unitId?(d(),i("div",ce,[r(a).reportDate?(d(),i("span",ge," Fecha: "+o(r(a).reportDate),1)):g("",!0),r(a).groupId!=null?(d(),i("span",pe," Grupo: "+o(r(a).groupId),1)):g("",!0),r(a).unitId!=null?(d(),i("span",_e," Unidad: "+o(r(a).unitId),1)):g("",!0)])):g("",!0),T(a)?(d(),i("div",ve,o(T(a)),1)):g("",!0)]),t("td",be,[t("div",Ee,o(a.username||"â€”"),1),t("div",fe,"Rol: "+o(a.userRole||"â€”"),1)]),t("td",Ce,o(a.ip||"â€”"),1),t("td",me,o(a.user_agent||"â€”"),1),t("td",Ae,[t("button",{class:"btn-ghost",onClick:s=>k(a)},"Ver",8,xe)])]))),128)),!$.value&&!f.value.length?(d(),i("tr",$e,e[14]||(e[14]=[t("td",{colspan:"7",class:"text-center py-6 text-slate-500"},"Sin resultados",-1)]))):g("",!0)])])]),t("div",he,[t("div",null,[e[16]||(e[16]=A("Total: ",-1)),t("b",null,o(C.value),1)]),t("div",Re,[t("button",{class:"btn-ghost",disabled:p.value<=1,onClick:e[5]||(e[5]=a=>E(p.value-1))},"Â«",8,ye),t("div",null,[e[17]||(e[17]=A("PÃ¡gina ",-1)),t("b",null,o(p.value),1)]),t("button",{class:"btn-ghost",disabled:p.value*y.value>=C.value,onClick:e[6]||(e[6]=a=>E(p.value+1))},"Â»",8,Te)])])])]),b.value?(d(),i("div",Ie,[t("div",Ue,[t("div",Oe,[t("div",Ne,"Detalles ("+o(h(b.value.action).label)+")",1),t("button",{class:"btn-ghost",onClick:e[7]||(e[7]=a=>b.value=null)},"Cerrar")]),t("pre",Se,o(L(r(b.value))),1)])])):g("",!0)])]))}},ke=j(De,[["__scopeId","data-v-ab670622"]]);export{ke as default};
