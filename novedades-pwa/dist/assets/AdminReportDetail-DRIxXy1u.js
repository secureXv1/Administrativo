import{c as p,o as c,r as $,a as l,b as yt,d as xe,e as f,w as le,f as A,v as he,T as Ge,g as q,h as C,n as Ne,i as M,t as g,F as k,j as F,k as _,l as bt,_ as It,m as S,p as D,u as St,q as Y,s as Ot,x as ze,y as Ct,z as J,A as ie,B as Et,C as wt,D as R,E as De,G as Nt,H as Dt}from"./index-BwwK2V4l.js";function ke(s){return s===0?!1:Array.isArray(s)&&s.length===0?!0:!s}function kt(s){return(...a)=>!s(...a)}function At(s,a){return s===void 0&&(s="undefined"),s===null&&(s="null"),s===!1&&(s="false"),s.toString().toLowerCase().indexOf(a.trim())!==-1}function xt(s){return s.filter(a=>!a.$isLabel)}function Ae(s,a){return u=>u.reduce((b,y)=>y[s]&&y[s].length?(b.push({$groupLabel:y[a],$isLabel:!0}),b.concat(y[s])):b,[])}const je=(...s)=>a=>s.reduce((u,b)=>b(u),a);var Lt={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(s,a){return ke(s)?"":a?s[a]:s}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||this.modelValue===0?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const s=this.search||"",a=s.toLowerCase().trim();let u=this.options.concat();return this.internalSearch?u=this.groupValues?this.filterAndFlat(u,a,this.label):this.filterOptions(u,a,this.label,this.customLabel):u=this.groupValues?Ae(this.groupValues,this.groupLabel)(u):u,u=this.hideSelected?u.filter(kt(this.isSelected)):u,this.taggable&&a.length&&!this.isExistingOption(a)&&(this.tagPosition==="bottom"?u.push({isTag:!0,label:s}):u.unshift({isTag:!0,label:s})),u.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map(s=>s[this.trackBy]):this.internalValue},optionKeys(){return(this.groupValues?this.flatAndStrip(this.options):this.options).map(a=>this.customLabel(a,this.label).toString().toLowerCase())},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:this.internalValue.length===0?null:this.internalValue[0]},filterAndFlat(s,a,u){return je(this.filterGroups(a,u,this.groupValues,this.groupLabel,this.customLabel),Ae(this.groupValues,this.groupLabel))(s)},flatAndStrip(s){return je(Ae(this.groupValues,this.groupLabel),xt)(s)},updateSearch(s){this.search=s},isExistingOption(s){return this.options?this.optionKeys.indexOf(s)>-1:!1},isSelected(s){const a=this.trackBy?s[this.trackBy]:s;return this.valueKeys.indexOf(a)>-1},isOptionDisabled(s){return!!s.$isDisabled},getOptionLabel(s){if(ke(s))return"";if(s.isTag)return s.label;if(s.$isLabel)return s.$groupLabel;const a=this.customLabel(s,this.label);return ke(a)?"":a},select(s,a){if(s.$isLabel&&this.groupSelect){this.selectGroup(s);return}if(!(this.blockKeys.indexOf(a)!==-1||this.disabled||s.$isDisabled||s.$isLabel)&&!(this.max&&this.multiple&&this.internalValue.length===this.max)&&!(a==="Tab"&&!this.pointerDirty)){if(s.isTag)this.$emit("tag",s.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{if(this.isSelected(s)){a!=="Tab"&&this.removeElement(s);return}this.multiple?this.$emit("update:modelValue",this.internalValue.concat([s])):this.$emit("update:modelValue",s),this.$emit("select",s,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(s){const a=this.options.find(u=>u[this.groupLabel]===s.$groupLabel);if(a){if(this.wholeGroupSelected(a)){this.$emit("remove",a[this.groupValues],this.id);const u=this.trackBy?a[this.groupValues].map(y=>y[this.trackBy]):a[this.groupValues],b=this.internalValue.filter(y=>u.indexOf(this.trackBy?y[this.trackBy]:y)===-1);this.$emit("update:modelValue",b)}else{const u=a[this.groupValues].filter(b=>!(this.isOptionDisabled(b)||this.isSelected(b)));this.max&&u.splice(this.max-this.internalValue.length),this.$emit("select",u,this.id),this.$emit("update:modelValue",this.internalValue.concat(u))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(s){return s[this.groupValues].every(a=>this.isSelected(a)||this.isOptionDisabled(a))},wholeGroupDisabled(s){return s[this.groupValues].every(this.isOptionDisabled)},removeElement(s,a=!0){if(this.disabled||s.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1){this.deactivate();return}const u=typeof s=="object"?this.valueKeys.indexOf(s[this.trackBy]):this.valueKeys.indexOf(s);if(this.multiple){const b=this.internalValue.slice(0,u).concat(this.internalValue.slice(u+1));this.$emit("update:modelValue",b)}else this.$emit("update:modelValue",null);this.$emit("remove",s,this.id),this.closeOnSelect&&a&&this.deactivate()},removeLastElement(){this.blockKeys.indexOf("Delete")===-1&&this.search.length===0&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&this.pointer===0&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick(()=>this.$refs.search&&this.$refs.search.focus())):this.preventAutofocus||typeof this.$el<"u"&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?this.$refs.search!==null&&typeof this.$refs.search<"u"&&this.$refs.search.blur():typeof this.$el<"u"&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if(typeof window>"u")return;const s=this.$el.getBoundingClientRect().top,a=window.innerHeight-this.$el.getBoundingClientRect().bottom;a>this.maxHeight||a>s||this.openDirection==="below"||this.openDirection==="bottom"?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(a-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(s-40,this.maxHeight))},filterOptions(s,a,u,b){return a?s.filter(y=>At(b(y,u),a)).sort((y,h)=>typeof this.filteringSortFunc=="function"?this.filteringSortFunc(y,h):b(y,u).length-b(h,u).length):s},filterGroups(s,a,u,b,y){return h=>h.map(d=>{if(!d[u])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];const w=this.filterOptions(d[u],s,a,y);return w.length?{[b]:d[b],[u]:w}:[]})}}},Vt={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(s,a){return{"multiselect__option--highlight":s===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(a)}},groupHighlight(s,a){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":a.$isLabel}];const u=this.options.find(b=>b[this.groupLabel]===a.$groupLabel);return u&&!this.wholeGroupDisabled(u)?["multiselect__option--group",{"multiselect__option--highlight":s===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(u)}]:"multiselect__option--disabled"},addPointerElement({key:s}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],s),this.pointerReset()},pointerForward(){this.pointer<this.filteredOptions.length-1&&(this.pointer++,this.$refs.list?.scrollTop<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){this.pointer>0?(this.pointer--,this.$refs.list?.scrollTop>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(s){this.pointer=s,this.pointerDirty=!0}}},Ke={name:"vue-multiselect",mixins:[Lt,Vt],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:s=>`and ${s} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1},useTeleport:{type:Boolean,default:!1}},data(){return{dropdownStyles:{},ready:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||this.singleValue===0)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return this.openDirection==="above"||this.openDirection==="top"?!0:this.openDirection==="below"||this.openDirection==="bottom"?!1:this.preferredOpenDirection==="above"},showSearchInput(){return this.searchable&&(this.hasSingleSelectedSlot&&(this.visibleSingleValue||this.visibleSingleValue===0)?this.isOpen:!0)},isRequired(){return this.required===!1?!1:this.internalValue.length<=0}},watch:{isOpen(s){s&&(this.useTeleport?(this.ready=!1,this.$nextTick(()=>{const a=this.$el.getBoundingClientRect();this.dropdownStyles={position:"absolute",top:`${a.bottom+window.scrollY}px`,left:`${a.left+window.scrollX}px`,width:`${a.width}px`,zIndex:9999},this.ready=!0})):this.ready=!0)}}};const $t=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],Rt={ref:"tags",class:"multiselect__tags"},_t={class:"multiselect__tags-wrap"},Mt=["textContent"],Tt=["onKeypress","onMousedown"],Bt=["textContent"],Ut={class:"multiselect__spinner"},Pt=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],Ft=["id","aria-multiselectable"],qt={key:0},Ht={class:"multiselect__option"},Gt=["aria-selected","id","role"],zt=["onClick","onMouseenter","data-select","data-selected","data-deselect"],jt=["data-select","data-deselect","onMouseenter","onMousedown"],Kt={class:"multiselect__option"},Zt={class:"multiselect__option"};function Xt(s,a,u,b,y,h){return c(),p("div",{tabindex:s.searchable?-1:u.tabindex,class:_([{"multiselect--active":s.isOpen,"multiselect--disabled":u.disabled,"multiselect--above":h.isAbove,"multiselect--has-options-group":h.hasOptionGroup},"multiselect"]),onFocus:a[14]||(a[14]=d=>s.activate()),onBlur:a[15]||(a[15]=d=>s.searchable?!1:s.deactivate()),onKeydown:[a[16]||(a[16]=q(C(d=>s.pointerForward(),["self","prevent"]),["down"])),a[17]||(a[17]=q(C(d=>s.pointerBackward(),["self","prevent"]),["up"]))],onKeypress:a[18]||(a[18]=q(C(d=>s.addPointerElement(d),["stop","self"]),["enter","tab"])),onKeyup:a[19]||(a[19]=q(d=>s.deactivate(),["esc"])),role:"combobox","aria-expanded":s.isOpen,"aria-owns":"listbox-"+s.id,"aria-activedescendant":s.isOpen&&s.pointer!==null?s.id+"-"+s.pointer:null},[$(s.$slots,"caret",{toggle:s.toggle},()=>[l("div",{onMousedown:a[0]||(a[0]=C(d=>s.toggle(),["prevent","stop"])),class:"multiselect__select"},null,32)]),$(s.$slots,"clear",{search:s.search}),l("div",Rt,[$(s.$slots,"selection",{search:s.search,remove:s.removeElement,values:h.visibleValues,isOpen:s.isOpen},()=>[A(l("div",_t,[(c(!0),p(k,null,F(h.visibleValues,(d,w)=>$(s.$slots,"tag",{option:d,search:s.search,remove:s.removeElement},()=>[(c(),p("span",{class:"multiselect__tag",key:w,onMousedown:a[1]||(a[1]=C(()=>{},["prevent"]))},[l("span",{textContent:g(s.getOptionLabel(d))},null,8,Mt),l("i",{tabindex:"1",onKeypress:q(C(B=>s.removeElement(d),["prevent"]),["enter"]),onMousedown:C(B=>s.removeElement(d),["prevent"]),class:"multiselect__tag-icon"},null,40,Tt)],32))])),256))],512),[[he,h.visibleValues.length>0]]),s.internalValue&&s.internalValue.length>u.limit?$(s.$slots,"limit",{key:0},()=>[l("strong",{class:"multiselect__strong",textContent:g(u.limitText(s.internalValue.length-u.limit))},null,8,Bt)]):f("v-if",!0)]),xe(Ge,{name:"multiselect__loading"},{default:le(()=>[$(s.$slots,"loading",{},()=>[A(l("div",Ut,null,512),[[he,u.loading]])])]),_:3}),s.searchable?(c(),p("input",{key:0,ref:"search",name:u.name,id:s.id,type:"text",autocomplete:"off",spellcheck:u.spellcheck,placeholder:s.placeholder,required:h.isRequired,style:Ne(h.inputStyle),value:s.search,disabled:u.disabled,tabindex:u.tabindex,"aria-label":u.name+"-searchbox",onInput:a[2]||(a[2]=d=>s.updateSearch(d.target.value)),onFocus:a[3]||(a[3]=C(d=>s.activate(),["prevent"])),onBlur:a[4]||(a[4]=C(d=>s.deactivate(),["prevent"])),onKeyup:a[5]||(a[5]=q(d=>s.deactivate(),["esc"])),onKeydown:[a[6]||(a[6]=q(C(d=>s.pointerForward(),["prevent"]),["down"])),a[7]||(a[7]=q(C(d=>s.pointerBackward(),["prevent"]),["up"])),a[9]||(a[9]=q(C(d=>s.removeLastElement(),["stop"]),["delete"]))],onKeypress:a[8]||(a[8]=q(C(d=>s.addPointerElement(d),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+s.id},null,44,Pt)):f("v-if",!0),h.isSingleLabelVisible?(c(),p("span",{key:1,class:"multiselect__single",onMousedown:a[10]||(a[10]=C((...d)=>s.toggle&&s.toggle(...d),["prevent"]))},[$(s.$slots,"singleLabel",{option:h.singleValue},()=>[M(g(s.currentOptionLabel),1)])],32)):f("v-if",!0),h.isPlaceholderVisible?(c(),p("span",{key:2,class:"multiselect__placeholder",onMousedown:a[11]||(a[11]=C((...d)=>s.toggle&&s.toggle(...d),["prevent"]))},[$(s.$slots,"placeholder",{},()=>[M(g(s.placeholder),1)])],32)):f("v-if",!0)],512),(c(),yt(bt,{to:"body",disabled:!u.useTeleport},[xe(Ge,{name:"multiselect"},{default:le(()=>[s.isOpen&&y.ready?(c(),p("div",{key:0,class:"multiselect__content-wrapper",onFocus:a[12]||(a[12]=(...d)=>s.activate&&s.activate(...d)),tabindex:"-1",onMousedown:a[13]||(a[13]=C(()=>{},["prevent"])),style:Ne([y.dropdownStyles,{maxHeight:s.optimizedHeight+"px"}]),ref:"list"},[l("ul",{class:"multiselect__content",style:Ne(h.contentStyle),role:"listbox",id:"listbox-"+s.id,"aria-multiselectable":s.multiple},[$(s.$slots,"beforeList"),s.multiple&&s.max===s.internalValue.length?(c(),p("li",qt,[l("span",Ht,[$(s.$slots,"maxElements",{},()=>[M("Maximum of "+g(s.max)+" options selected. First remove a selected option to select another.",1)])])])):f("v-if",!0),!s.max||s.internalValue.length<s.max?(c(!0),p(k,{key:1},F(s.filteredOptions,(d,w)=>(c(),p("li",{class:"multiselect__element",key:w,"aria-selected":s.isSelected(d),id:s.id+"-"+w,role:d&&(d.$isLabel||d.$isDisabled)?null:"option"},[d&&(d.$isLabel||d.$isDisabled)?f("v-if",!0):(c(),p("span",{key:0,class:_([s.optionHighlight(w,d),"multiselect__option"]),onClick:C(B=>s.select(d),["stop"]),onMouseenter:C(B=>s.pointerSet(w),["self"]),"data-select":d&&d.isTag?s.tagPlaceholder:h.selectLabelText,"data-selected":h.selectedLabelText,"data-deselect":h.deselectLabelText},[$(s.$slots,"option",{option:d,search:s.search,index:w},()=>[l("span",null,g(s.getOptionLabel(d)),1)])],42,zt)),d&&(d.$isLabel||d.$isDisabled)?(c(),p("span",{key:1,"data-select":s.groupSelect&&h.selectGroupLabelText,"data-deselect":s.groupSelect&&h.deselectGroupLabelText,class:_([s.groupHighlight(w,d),"multiselect__option"]),onMouseenter:C(B=>s.groupSelect&&s.pointerSet(w),["self"]),onMousedown:C(B=>s.selectGroup(d),["prevent"])},[$(s.$slots,"option",{option:d,search:s.search,index:w},()=>[l("span",null,g(s.getOptionLabel(d)),1)])],42,jt)):f("v-if",!0)],8,Gt))),128)):f("v-if",!0),A(l("li",null,[l("span",Kt,[$(s.$slots,"noResult",{search:s.search},()=>[a[20]||(a[20]=M("No elements found. Consider changing the search query."))])])],512),[[he,u.showNoResults&&s.filteredOptions.length===0&&s.search&&!u.loading]]),A(l("li",null,[l("span",Zt,[$(s.$slots,"noOptions",{},()=>[a[21]||(a[21]=M("List is empty."))])])],512),[[he,u.showNoOptions&&(s.options.length===0||h.hasOptionGroup===!0&&s.filteredOptions.length===0)&&!s.search&&!u.loading]]),$(s.$slots,"afterList")],12,Ft)],36)):f("v-if",!0)]),_:3})],8,["disabled"]))],42,$t)}Ke.render=Xt;const Yt={class:"min-h-screen bg-slate-50"},Qt={class:"sticky top-0 z-10 backdrop-blur bg-white/70 border-b border-slate-200"},Jt={class:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"},Wt={class:"text-slate-900 font-semibold text-lg sm:text-2xl"},es={class:"max-w-6xl mx-auto px-2 sm:px-4 py-6 space-y-4"},ts={key:0,class:"text-center py-12 text-brand-700 font-semibold"},ss={key:1,class:"text-center py-12 text-red-500"},is={class:"card mb-3"},ls={class:"card-body grid grid-cols-1 sm:grid-cols-6 gap-3 sm:items-end"},as=["disabled"],ns={key:0,value:"all"},os=["value"],rs={class:"sm:col-span-3"},us=["value"],ds={key:0,class:"text-xs text-slate-500 mt-1"},cs={class:"card"},ps={class:"card-body"},hs={class:"grid grid-cols-1 sm:grid-cols-6 gap-2 sm:items-end"},ms=["value"],vs={class:"flex items-center gap-2 mt-2 sm:mt-0"},gs={class:"mt-4 flex flex-wrap gap-2"},fs={class:"card"},ys={class:"card-body overflow-x-auto p-0"},bs={class:"table min-w-full text-xs sm:text-sm"},Is={key:0},Ss={key:1},Os={key:2,class:"text-center"},Cs={class:"font-medium text-slate-900"},Es={key:0},ws={class:"text-slate-700"},Ns={key:1},Ds={class:"text-slate-700"},ks={key:2,class:"text-slate-300"},As=["title"],xs={key:2,class:"text-right"},Ls=["onClick"],Vs={key:3,class:"text-right"},$s=["onClick"],Rs={key:0},_s=["colspan"],Ms={class:"bg-white rounded-xl shadow max-w-2xl w-full"},Ts={class:"p-4 border-b flex items-center justify-between"},Bs={class:"font-semibold text-slate-800"},Us={class:"p-4 space-y-4"},Ps={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Fs=["value"],qs={key:0,class:"sm:col-span-2"},Hs={class:"flex items-center justify-between w-full"},Gs={class:"text-xs text-slate-400"},zs={key:1},js={key:2},Ks={key:3},Zs={key:4,class:"sm:col-span-3"},Xs={key:5,class:"sm:col-span-3 text-xs text-slate-500"},Ys={class:"flex justify-end gap-2 pt-2"},Qs=["disabled"],Js={key:0,class:"fixed inset-0 z-[9998] grid place-items-center p-4"},Ws={class:"relative z-10 w-full max-w-5xl rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-200"},ei={class:"px-5 py-4 rounded-t-2xl text-white flex items-center justify-between bg-gradient-to-r from-slate-900 via-indigo-700 to-blue-600 dark:from-slate-950 dark:via-indigo-900 dark:to-blue-800"},ti={class:"flex items-center gap-3"},si={class:"text-xl font-semibold tracking-tight"},ii={key:0,class:"opacity-80 text-sm"},li={class:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs bg-white/15 text-white"},ai={class:"px-5 py-3 flex flex-wrap items-center gap-3"},ni={class:"flex items-center gap-2"},oi={class:"inline-flex items-center gap-1 rounded-full border border-slate-300 bg-white px-3 py-1 text-xs text-slate-700 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-700"},ri={class:"ml-auto inline-flex rounded-full p-1 bg-slate-200/70 dark:bg-slate-700/60"},ui={class:"px-5 pb-5 max-h-[70vh] overflow-auto"},di={key:0},ci={class:"grid grid-cols-7 gap-2"},pi=["title"],hi={class:"text-[11px] font-medium opacity-60"},mi={key:0,class:"mt-auto text-center text-lg leading-none"},vi={key:1,class:"text-[11px] text-center truncate mt-1 opacity-85"},gi={key:1,class:"space-y-4 relative"},fi={class:"opacity-70"},yi={class:"opacity-70"},bi={key:2,class:"mt-5 flex flex-wrap gap-2 text-xs"},Ii={__name:"AdminReportDetail",setup(s){const a=S([]);async function u(){try{const{data:i}=await R.get("/admin/groups",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});a.value=Array.isArray(i)?i:[]}catch{a.value=[]}}const b=D(()=>B.value&&B.value.role==="leader_group"),y=S("all"),h=St(),d=Ct(),w={id:11001,name:"BOGOTÁ, D.C.",dept:"BOGOTÁ, D.C.",label(){return`${this.name} (${this.dept})`}},B=S(null);async function Ze(){try{const{data:i}=await R.get("/me",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});B.value=i}catch{B.value=null}}const W=D(()=>{const i=String(B.value?.role||"").toLowerCase();return["leader_group","superadmin","supervision","supervisor"].includes(i)}),Le=D(()=>h.params.id?String(h.params.id):null),me=D(()=>h.query.date?String(h.query.date):new Date().toISOString().slice(0,10)),x=D(()=>h.query.groupId?String(h.query.groupId):null),ve=S(!1),L=D(()=>ve.value||!!x.value),ge=S(!0),U=S({groupCode:"",unitName:"",date:"—"}),T=S(!1),H=S([]),Ve=S([]),N=S({...{q:"",category:"ALL",state:"ALL",unitId:"ALL",onlyNovelties:!1}}),$e=["SIN NOVEDAD","SERVICIO","COMISIÓN DEL SERVICIO","FRANCO FRANCO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","COMISIÓN EN EL EXTERIOR","COMISIÓN DE ESTUDIO","SUSPENDIDO","HOSPITALIZADO"],O=S(me.value),V=S(String(h.query.unitId||"")),G=S([]);function K(){const i=new Date,e=String(i.getMonth()+1).padStart(2,"0"),t=String(i.getDate()).padStart(2,"0");return`${i.getFullYear()}-${e}-${t}`}async function ee(i){try{const e={date_from:i,date_to:i};L.value&&x.value&&(e.groupId=x.value);const{data:t}=await R.get("/dashboard/reports",{params:e,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),r=Array.isArray(t?.items)?t.items:[],m=new Map;for(const o of r)if(o.unitId&&o.unitName){const E=String(o.unitId);m.has(E)||m.set(E,{id:E,name:o.unitName})}G.value=Array.from(m.values()).sort((o,E)=>String(o.name||"").localeCompare(String(E.name||"")));const n=String(h.query.unitId||"");if(n){if(V.value=n,!G.value.some(o=>String(o.id)===n))try{const{data:o}=await R.get(`/admin/units/${n}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});o?.id?G.value.unshift({id:String(o.id),name:o.name||`Unidad ${o.id}`}):G.value.unshift({id:n,name:`Unidad ${n}`})}catch{G.value.unshift({id:n,name:`Unidad ${n}`})}}else V.value=""}catch(e){console.error("loadUnitsIndex error",e),G.value=[]}}async function te(i,e){try{const t=String(e??"").trim(),r=/^\d+$/.test(t)?Number(t):t,m={date_from:i,date_to:i,unitId:r};L.value&&x.value&&(m.groupId=x.value);const{data:n}=await R.get("/dashboard/reports",{params:m,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let o=Array.isArray(n?.items)?n.items:[];if(o.length&&(o=o.filter(I=>String(I.unitId)===String(r))),!o.length){await d.replace({name:h.name,params:h.params,query:{...h.query,unitId:String(r||""),date:i}});return}const E=o.sort((I,se)=>String(I.id).localeCompare(String(se.id))).pop();await d.replace({name:h.name,params:{id:String(E.id)},query:{...h.query,unitId:String(r),date:i}}),T.value=!1,H.value=[],await ye(String(E.id)),U.value={...U.value,date:i},T.value=!0}catch(t){console.warn("gotoReportForUnit error:",t?.message||t),await d.replace({name:h.name,params:h.params,query:{...h.query,unitId:String(e||""),date:i}})}}async function Xe(){const i=O.value||K();await ee(i),V.value?await te(i,V.value):(L.value&&x.value?await Q(i,x.value):await ae(i),await d.replace({name:h.name,params:h.params,query:{...h.query,date:i,unitId:""}}),U.value={...U.value,date:i})}async function Re(){const i=O.value||K(),e=V.value;if(!e){L.value&&x.value&&await Q(i,x.value),await d.replace({name:h.name,params:h.params,query:{...h.query,date:i,unitId:""}});return}await te(i,e)}Y(()=>h.query,async i=>{const e=String(i.date||K()),t=String(i.unitId||"");(e!==O.value||t!==V.value)&&(O.value=e,V.value=t,await ee(e),t?await te(e,t):L.value&&x.value&&await Q(e,x.value))});function fe(i){if(!i)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(i)){const[n,o,E]=i.split("-");return`${E}/${o}/${n}`}const e=new Date(i);if(isNaN(e))return"";const t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),m=e.getFullYear();return`${t}/${r}/${m}`}function Ye(i){return String(i||"").toUpperCase()==="SO"?"ME":i}const Qe={OF:1,SO:2,PT:3};function _e(i){const e=String(i||"").toUpperCase();return Qe[e]||99}function Je(i){const e=String(i||"").toUpperCase();return e==="SIN NOVEDAD"?"bg-green-50 text-green-700 border-green-200":e==="SERVICIO"||e==="COMISIÓN DEL SERVICIO"?"bg-sky-50 text-sky-700 border-sky-200":"bg-amber-50 text-amber-800 border-amber-200"}async function ye(i){const{data:e}=await R.get(`/admin/report-agents/${i}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=o=>({...o,_key:`${o.code}-${o.unitName||""}-${o.state}-${o.novelty_start||""}-${o.novelty_end||""}`,municipality:o.municipalityName&&o.dept?`${o.municipalityName} (${o.dept})`:o.municipalityName||"",municipalityName:o.municipalityName||null,municipalityDept:o.dept||null,municipalityId:o.municipalityId!=null?Number(o.municipalityId):null,novelty_description:o.novelty_description||o.descripcion,reportId:i}),r=(Array.isArray(e)?e:[]).map(t);H.value=r;const m=r[0],n=O.value||me.value;U.value={groupCode:m?.groupCode||"",unitName:m?.unitName||"",date:n},T.value=!0,await be()}async function Q(i,e){const{data:t}=await R.get("/dashboard/reports",{params:{date_from:i,date_to:i,groupId:e},headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),r=Array.isArray(t?.items)?t.items:[];if(!r.length){T.value=!1;return}U.value={groupCode:r[0].groupCode,unitName:"",date:i},Ve.value=[...new Map(r.map(n=>[String(n.unitName||""),{id:n.unitId,name:n.unitName}])).values()].filter(n=>!!n.id).sort((n,o)=>(n.name||"").localeCompare(o.name||""));const m=[];for(const n of r){const{data:o}=await R.get(`/admin/report-agents/${n.id}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),E=(Array.isArray(o)?o:[]).map(I=>({...I,_key:`${I.code}-${I.unitName||""}-${I.state}-${I.novelty_start||""}-${I.novelty_end||""}`,municipality:I.municipalityName&&I.dept?`${I.municipalityName} (${I.dept})`:I.municipalityName||"",municipalityName:I.municipalityName||null,municipalityDept:I.dept||null,municipalityId:I.municipalityId!=null?Number(I.municipalityId):null,novelty_description:I.novelty_description||I.descripcion,reportId:n.id}));m.push(...E)}H.value=m,T.value=!0,await be()}function We(i){const e=["SIN NOVEDAD","SERVICIO","COMISIÓN DEL SERVICIO"];let t=0;for(let r=i.length-1;r>=0;r--){const m=String(i[r]?.state||"").toUpperCase();if(e.includes(m))t++;else break}return t}async function be(){for(const i of H.value)try{const{data:e}=await R.get(`/admin/agents/${i.agentId||i.id}/history`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{from:"2020-01-01",to:K()}}),t=Array.isArray(e?.items)?e.items:[];i.diasLaborados=We(t)}catch{i.diasLaborados=0}}async function ae(i){try{ve.value=!0,T.value=!1,H.value=[];const{data:e}=await R.get("/admin/report/detail",{params:{date:i},headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),r=(Array.isArray(e?.items)?e.items:[]).map(n=>({...n,_key:`${n.code}-${n.unitName||""}-${n.state}-${n.novelty_start||""}-${n.novelty_end||""}`,municipality:n.municipalityName&&n.dept?`${n.municipalityName} (${n.dept})`:n.municipalityName||"",municipalityName:n.municipalityName||null,municipalityDept:n.dept||null,municipalityId:n.municipalityId!=null?Number(n.municipalityId):null,novelty_description:n.novelty_description||n.descripcion,reportId:n.reportId}));H.value=r,U.value={groupCode:"Todos",unitName:"",date:i},T.value=r.length>0;const m=new Map;for(const n of r)if(n.unitId&&n.unitName){const o=String(n.unitId);m.has(o)||m.set(o,{id:o,name:n.unitName})}G.value=[...m.values()].sort((n,o)=>String(n.name||"").localeCompare(String(o.name||""))),await be()}catch(e){console.warn("loadAllReports error:",e?.message||e),T.value=!1,H.value=[]}}const ne=D(()=>{let i=H.value.slice();const e=N.value.q.trim().toUpperCase();if(e&&(i=i.filter(t=>String(t.code||"").toUpperCase().includes(e)||String(t.novelty_description||"").toUpperCase().includes(e)||String(t.unitName||"").toUpperCase().includes(e))),N.value.category!=="ALL"&&(i=i.filter(t=>String(t.category)===N.value.category)),N.value.state!=="ALL"&&(i=i.filter(t=>String(t.state).toUpperCase()===N.value.state)),N.value.onlyNovelties&&(i=i.filter(t=>String(t.state).toUpperCase()!=="SIN NOVEDAD")),L.value&&N.value.unitId!=="ALL"){const t=Ve.value.find(r=>String(r.id)===String(N.value.unitId))?.name||"";i=i.filter(r=>String(r.unitName||"")===t)}return i.sort((t,r)=>{const m=_e(t.category),n=_e(r.category);return m!==n?m-n:String(t.code).localeCompare(String(r.code))})}),et=D(()=>{const i={"SIN NOVEDAD":0,SERVICIO:0,"COMISIÓN DEL SERVICIO":0,otros:0};for(const e of ne.value){const t=String(e.state).toUpperCase();t==="SIN NOVEDAD"?i["SIN NOVEDAD"]++:t==="SERVICIO"?i.SERVICIO++:t==="COMISIÓN DEL SERVICIO"?i["COMISIÓN DEL SERVICIO"]++:i.otros++}return[{key:"sn",label:"Sin novedad",count:i["SIN NOVEDAD"],cls:"bg-green-50 text-green-700 border-green-200",dot:"bg-green-600"},{key:"srv",label:"Servicio",count:i.SERVICIO,cls:"bg-sky-50 text-sky-700 border-sky-200",dot:"bg-sky-600"},{key:"cds",label:"Comisión del servicio",count:i["COMISIÓN DEL SERVICIO"],cls:"bg-sky-50 text-sky-700 border-sky-200",dot:"bg-sky-600"},{key:"oth",label:"Otros",count:i.otros,cls:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-600"}]}),Ie=S(!1),j=S(null),oe=S(!1),v=S({state:"SIN NOVEDAD",municipio:null,novelty_start:"",novelty_end:"",novelty_description:""}),Se=D(()=>["SERVICIO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","COMISIÓN EN EL EXTERIOR","COMISIÓN DE ESTUDIO","SUSPENDIDO"].includes(v.value.state)),Me=D(()=>["SERVICIO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","COMISIÓN EN EL EXTERIOR","COMISIÓN DE ESTUDIO","COMISIÓN DEL SERVICIO","SUSPENDIDO","HOSPITALIZADO"].includes(v.value.state)),tt=D(()=>v.value.state==="COMISIÓN DEL SERVICIO");function st(i){if(!W.value)return;j.value=i;const e=String(i.state||"").toUpperCase(),t=e==="COMISIÓN DEL SERVICIO";let r=null;if(t){const m=i.municipalityId!=null?Number(i.municipalityId):null,n=i.municipalityName||null,o=i.municipalityDept||null;m&&(r=Te(m,n,o))}v.value={state:e,municipio:r,novelty_start:i.novelty_start||"",novelty_end:i.novelty_end||"",novelty_description:i.novelty_description||""},Ie.value=!0}Y(()=>v.value.state,i=>{if(String(i||"").toUpperCase()!=="COMISIÓN DEL SERVICIO")v.value.municipio=null;else{const t=j.value;t?.municipalityId&&!v.value.municipio&&(v.value.municipio=Te(t.municipalityId,t.municipalityName,t.municipalityDept))}});function re(){Ie.value=!1,j.value=null}const Z=S([]),Oe=S(!1);let Ce=null;async function it(i){Ce&&clearTimeout(Ce),Ce=setTimeout(async()=>{const e=String(i||"").trim();if(e.length<2){Z.value=[];return}Oe.value=!0;try{const{data:t}=await R.get("/catalogs/municipalities",{params:{q:e,limit:15},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});Z.value=(t||[]).map(r=>({id:r.id,label:`${r.name} (${r.dept})`}))}catch{Z.value=[]}finally{Oe.value=!1}},250)}function Te(i,e,t){if(!i)return null;const r=Number(i);let m=Z.value.find(n=>Number(n.id)===r);return m||(m={id:r,label:e?`${e} (${t||""})`:`id ${r}`},Z.value=[m,...Z.value]),m}async function lt(){if(j.value){if(v.value.state==="COMISIÓN DEL SERVICIO"&&!v.value.municipio?.id){alert("Selecciona un municipio para Comisión del servicio");return}if(v.value.state==="COMISIÓN DEL SERVICIO"&&!v.value.novelty_description?.trim()){alert("La descripción es requerida para Comisión del servicio");return}if(v.value.state==="HOSPITALIZADO"){if(!v.value.novelty_start){alert("Falta fecha de inicio (HOSPITALIZADO)");return}if(!v.value.novelty_description?.trim()){alert("Falta descripción (HOSPITALIZADO)");return}}if(Se.value&&(!v.value.novelty_start||!v.value.novelty_end)){alert("Completa las fechas de la novedad (inicio y fin)");return}if(Me.value&&!v.value.novelty_description?.trim()){alert("La descripción es requerida para este estado");return}oe.value=!0;try{const i=v.value.state==="HOSPITALIZADO";await R.put(`/admin/report-agents/${j.value.reportId}/${j.value.agentId}`,{state:v.value.state,municipalityId:v.value.state==="COMISIÓN DEL SERVICIO"?v.value.municipio?.id||null:["SERVICIO","SIN NOVEDAD"].includes(v.value.state)?w.id:null,novelty_start:v.value.novelty_start||null,novelty_end:i?null:v.value.novelty_end||null,novelty_description:v.value.novelty_description||null},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let e=null,t=null,r=null,m="";if(v.value.state==="COMISIÓN DEL SERVICIO"){if(e=v.value.municipio?.id||null,v.value.municipio?.label){const n=v.value.municipio.label.split(" (");t=n[0]||null,r=n[1]?n[1].replace(/\)$/,""):null,m=v.value.municipio.label}}else["SERVICIO","SIN NOVEDAD"].includes(v.value.state)&&(e=w.id,t=w.name,r=w.dept,m=w.label());Object.assign(j.value,{state:v.value.state,municipalityId:e,municipalityName:t,municipalityDept:r,municipality:m||(t?`${t} (${r||""})`:"N/A"),novelty_start:v.value.novelty_start||null,novelty_end:i?null:v.value.novelty_end||null,novelty_description:v.value.novelty_description||null}),re()}catch(i){alert(i?.response?.data?.detail||i?.response?.data?.error||"No se pudo guardar")}finally{oe.value=!1}}}async function at(){const i=ne.value.map(m=>({codigo:m.code,categoria:m.category,unidad:m.unitName||"",estado:m.state,ubicacion:m.municipality||"",descripcion:m.novelty_description||"",fecha_inicio:m.novelty_start?String(m.novelty_start).slice(0,10):"",fecha_fin:m.novelty_end?String(m.novelty_end).slice(0,10):""})),e=De.json_to_sheet(i),t=De.book_new();De.book_append_sheet(t,e,"Detalle");const r=Nt(t,{bookType:"xlsx",type:"array"});Dt.saveAs(new Blob([r],{type:"application/octet-stream"}),`detalle_${U.value.groupCode}_${U.value.date}.xlsx`)}Ot(async()=>{ge.value=!0,await Ze(),await u();const i=h.query.groupId?String(h.query.groupId):b.value&&a.value[0]?String(a.value[0].id):"all";y.value=i;try{const e=String(h.query.date||""),t=String(h.query.unitId||"");O.value=e||me.value,V.value=t,await ee(O.value),V.value&&O.value?await te(O.value,V.value):L.value&&x.value?await Q(O.value,x.value):Le.value?(await ye(Le.value),U.value={...U.value,date:O.value}):await ae(O.value),b.value&&a.value.length&&(y.value=String(a.value[0].id))}catch{T.value=!1}finally{ge.value=!1}}),Y(()=>h.params.id,async(i,e)=>{if(i&&i!==e){T.value=!1,H.value=[];try{await ye(String(i))}finally{T.value=!0}}}),Y(V,async(i,e)=>{i!==e&&await Re()}),Y(()=>h.query,async i=>{const e=String(i.date||K()),t=String(i.unitId||"");(e!==O.value||t!==V.value)&&(O.value=e,V.value=t,await ee(e),t?await te(e,t):L.value&&x.value?await Q(e,x.value):await ae(e))}),Y(y,async(i,e)=>{i!==e&&(await d.replace({name:h.name,params:h.params,query:{...h.query,groupId:i==="all"?void 0:i,unitId:""}}),await ee(O.value),i!=="all"?(ve.value=!1,await Q(O.value,i)):await ae(O.value))}),Y(()=>h.query.groupId,i=>{i&&String(y.value)!==String(i)&&(y.value=String(i)),!i&&y.value!=="all"&&(y.value="all")});const z=S({open:!1,agent:null}),X=S("calendar"),ue=S([]),P=S(new Date);function de(i){return i.toISOString().slice(0,10)}function Be(i){const e=new Date(i);return e.setDate(1),e.setHours(0,0,0,0),e}function Ue(i){const e=new Date(i);return e.setMonth(e.getMonth()+1,0),e.setHours(0,0,0,0),e}function Pe(i,e){const t=new Date(i);return t.setMonth(t.getMonth()+e),t}function nt(i){return new Intl.DateTimeFormat("es-CO",{month:"long",year:"numeric"}).format(i)}function ot(i){return(i.getDay()+6)%7}const Fe=D(()=>de(Be(P.value))),qe=D(()=>de(Ue(P.value))),rt=D(()=>nt(P.value));function ut(){P.value=Pe(P.value,-1),pe()}function dt(){P.value=Pe(P.value,1),pe()}function ct(){P.value=new Date((O.value||K())+"T00:00:00"),pe()}function Ee(i){const e=String(i||"").toUpperCase();return{"SIN NOVEDAD":"✅",SERVICIO:"🧭","COMISIÓN DEL SERVICIO":"📌","FRANCO FRANCO":"🛌",VACACIONES:"🏖️","LICENCIA DE MATERNIDAD":"👶","LICENCIA DE LUTO":"🕊️","LICENCIA REMUNERADA":"📝","LICENCIA NO REMUNERADA":"📝","EXCUSA DEL SERVICIO":"📝","LICENCIA PATERNIDAD":"🍼",PERMISO:"⏳","COMISIÓN EN EL EXTERIOR":"✈️","COMISIÓN DE ESTUDIO":"🎓",SUSPENDIDO:"⛔",HOSPITALIZADO:"🏥"}[e]||"•"}function ce(i){const e=String(i||"").toUpperCase();return{"SIN NOVEDAD":{bg:"bg-emerald-100",pill:"bg-emerald-100 text-emerald-800",dot:"bg-emerald-500"},SERVICIO:{bg:"bg-sky-100",pill:"bg-sky-100 text-sky-800",dot:"bg-sky-500"},"COMISIÓN DEL SERVICIO":{bg:"bg-indigo-100",pill:"bg-indigo-100 text-indigo-800",dot:"bg-indigo-500"},"FRANCO FRANCO":{bg:"bg-gray-100",pill:"bg-gray-100 text-gray-800",dot:"bg-gray-500"},VACACIONES:{bg:"bg-amber-100",pill:"bg-amber-100 text-amber-800",dot:"bg-amber-500"},SUSPENDIDO:{bg:"bg-rose-100",pill:"bg-rose-100 text-rose-800",dot:"bg-rose-500"},HOSPITALIZADO:{bg:"bg-rose-100",pill:"bg-rose-100 text-rose-800",dot:"bg-rose-500"}}[e]||{bg:"bg-slate-100",pill:"bg-slate-100 text-slate-700",dot:"bg-slate-400"}}function He(i){return i=String(i||""),i.length<=16?i:i.slice(0,16)+"…"}const pt=["SIN NOVEDAD","SERVICIO","COMISIÓN DEL SERVICIO","VACACIONES","FRANCO FRANCO","SUSPENDIDO","HOSPITALIZADO"];async function ht(i){const e=i.agentId??i.id;e&&(z.value={open:!0,agent:{id:e,code:i.code,nickname:i.nickname}},X.value="calendar",P.value=new Date((O.value||K())+"T00:00:00"),await pe())}async function pe(){if(z.value.agent)try{const{data:i}=await R.get(`/admin/agents/${z.value.agent.id}/history`,{params:{from:Fe.value,to:qe.value},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});ue.value=Array.isArray(i?.items)?i.items:[]}catch(i){console.warn("No se pudo cargar historial:",i?.response?.data?.error||i.message),ue.value=[]}}const mt=D(()=>{const i=Be(P.value),e=Ue(P.value),t=ot(i),r=e.getDate(),m=new Map(ue.value.map(o=>[String(o.date),o])),n=[];for(let o=0;o<t;o++)n.push({key:"pad-"+o,day:"",state:null,title:""});for(let o=1;o<=r;o++){const E=new Date(i);E.setDate(o);const I=de(E),se=m.get(I),we=se?.state||null,gt=we?`${I} — ${we}${se?.municipalityName?" — "+se.municipalityName:""}`:I,ft=I===de(new Date);n.push({key:I,day:o,state:we,title:gt,isToday:ft})}for(;n.length%7;)n.push({key:"tail-"+n.length,day:"",state:null,title:""});return n}),vt=D(()=>{const i=[...ue.value].sort((t,r)=>String(t.date).localeCompare(String(r.date))),e=[];for(const t of i){const r=t.state||"SIN NOVEDAD",m=String(r).toUpperCase()==="COMISIÓN DEL SERVICIO",n=m?t.municipalityName||"—":null,o=m?`${r}::${n}`:r,E=e[e.length-1];E&&E.key===o?(E.to=t.date,E.count+=1):e.push({key:o,state:r,municipalityName:n,from:t.date,to:t.date,count:1})}return e});return(i,e)=>(c(),p(k,null,[l("div",Yt,[l("header",Qt,[l("div",Jt,[l("h1",Wt,g(L.value?"Detalle de reporte del grupo":"Detalle de reporte de unidad"),1),l("button",{onClick:e[0]||(e[0]=t=>ze(d).back()),class:"btn-ghost"},"Volver")])]),l("main",es,[ge.value?(c(),p("div",ts,"Cargando...")):T.value?(c(),p(k,{key:2},[l("div",is,[l("div",ls,[l("div",null,[e[18]||(e[18]=l("label",{class:"label"},"Fecha",-1)),A(l("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=t=>O.value=t),class:"input",onChange:Xe},null,544),[[J,O.value]])]),l("div",null,[e[19]||(e[19]=l("label",{class:"label"},"Grupo",-1)),A(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),class:"input",disabled:b.value},[b.value?f("",!0):(c(),p("option",ns,"Todos")),(c(!0),p(k,null,F(a.value,t=>(c(),p("option",{key:t.id,value:String(t.id)},g(t.code)+" ("+g(t.name)+") ",9,os))),128))],8,as),[[ie,y.value]])]),l("div",rs,[e[21]||(e[21]=l("label",{class:"label"},"Unidad",-1)),A(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),class:"input",onChange:Re},[e[20]||(e[20]=l("option",{value:""},"Todas las unidades…",-1)),(c(!0),p(k,null,F(G.value,t=>(c(),p("option",{key:t.id,value:String(t.id)},g(t.name),9,us))),128))],544),[[ie,V.value]]),G.value.length?f("",!0):(c(),p("p",ds," No hay unidades para la fecha seleccionada. "))])])]),l("div",cs,[l("div",ps,[l("div",hs,[l("div",null,[e[22]||(e[22]=l("label",{class:"label"},"Búsqueda",-1)),A(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>N.value.q=t),class:"input",placeholder:"Código o texto…"},null,512),[[J,N.value.q]])]),l("div",null,[e[24]||(e[24]=l("label",{class:"label"},"Categoría",-1)),A(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>N.value.category=t),class:"input"},e[23]||(e[23]=[l("option",{value:"ALL"},"Todas",-1),l("option",{value:"OF"},"OF",-1),l("option",{value:"SO"},"ME",-1),l("option",{value:"PT"},"PT",-1)]),512),[[ie,N.value.category]])]),l("div",null,[e[26]||(e[26]=l("label",{class:"label"},"Estado",-1)),A(l("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>N.value.state=t),class:"input"},[e[25]||(e[25]=l("option",{value:"ALL"},"Todos",-1)),(c(),p(k,null,F($e,t=>l("option",{key:t,value:t},g(t),9,ms)),64))],512),[[ie,N.value.state]])]),l("div",vs,[A(l("input",{id:"solo-nov",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>N.value.onlyNovelties=t),class:"h-4 w-4"},null,512),[[Et,N.value.onlyNovelties]]),e[27]||(e[27]=l("label",{class:"label cursor-pointer",for:"solo-nov"},"Solo novedades",-1))]),l("div",{class:"flex gap-2"},[l("button",{class:"flex-1 sm:flex-none inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700",onClick:at},"Descargar")])]),l("div",gs,[(c(!0),p(k,null,F(et.value,t=>(c(),p("span",{key:t.key,class:_(["inline-flex items-center gap-2 px-3 py-1 rounded-full border text-sm",t.cls])},[l("span",{class:_(["inline-block w-2.5 h-2.5 rounded-full",t.dot])},null,2),M(" "+g(t.label)+": ",1),l("b",null,g(t.count),1)],2))),128))])])]),l("div",fs,[l("div",ys,[l("table",bs,[l("thead",null,[l("tr",null,[e[28]||(e[28]=l("th",null,"Código",-1)),e[29]||(e[29]=l("th",null,"Agente",-1)),e[30]||(e[30]=l("th",null,"Cat",-1)),L.value?(c(),p("th",Is,"Grupo")):f("",!0),L.value?(c(),p("th",Ss,"Unidad")):f("",!0),e[31]||(e[31]=l("th",null,"Novedad",-1)),e[32]||(e[32]=l("th",null,"Ubicación",-1)),e[33]||(e[33]=l("th",null,"Descripción",-1)),e[34]||(e[34]=l("th",null,"Inicio - Fin",-1)),e[35]||(e[35]=l("th",null,"Días Lab",-1)),e[36]||(e[36]=l("th",null,"Historial",-1)),W.value?(c(),p("th",Os,"Acciones")):f("",!0)])]),l("tbody",null,[(c(!0),p(k,null,F(ne.value,t=>(c(),p("tr",{key:t._key},[l("td",Cs,g(t.code),1),l("td",null,g(t.nickname||"—"),1),l("td",null,g(Ye(t.category)),1),L.value?(c(),p("td",Es,[l("span",ws,g(t.groupCode||"—"),1)])):f("",!0),L.value?(c(),p("td",Ns,[l("span",Ds,g(t.unitName||"—"),1)])):f("",!0),l("td",null,[l("span",{class:_(["inline-flex px-2 py-0.5 rounded-full text-xs font-semibold border",Je(t.state)])},g(t.state),3)]),l("td",null,g(t.municipality||"N/A"),1),l("td",null,g(t.novelty_description||"—"),1),l("td",null,[t.novelty_start&&t.novelty_end?(c(),p(k,{key:0},[M(g(fe(t.novelty_start))+" – "+g(fe(t.novelty_end)),1)],64)):t.novelty_start?(c(),p(k,{key:1},[M(g(fe(t.novelty_start)),1)],64)):(c(),p("span",ks,"—"))]),l("td",null,[l("span",{class:_(["inline-block min-w-[2.5em] text-center rounded px-1",t.diasLaborados>=45?"bg-red-100 text-red-600 font-bold border border-red-200":t.diasLaborados>=30?"bg-orange-100 text-orange-700 font-semibold border border-orange-200":t.diasLaborados>0?"bg-green-50 text-green-700 font-semibold border border-green-200":"text-slate-400 border border-slate-200 bg-white"]),title:t.diasLaborados>=45?"¡Alerta! tiempo prolongado sin descanso ":t.diasLaborados>=30?"Atención: Más de un mes sin descansar":t.diasLaborados>0?"Días consecutivos en servicio o sin novedad":"Sin días laborados"},g(t.diasLaborados??0),11,As)]),W.value?(c(),p("td",xs,[l("button",{class:"btn-ghost p-1",title:"Historial",onClick:r=>ht(t)},e[37]||(e[37]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[l("path",{d:"M12 8v4l3 3"}),l("circle",{cx:"12",cy:"12",r:"9"})],-1)]),8,Ls)])):f("",!0),W.value?(c(),p("td",Vs,[l("button",{class:"btn-ghost p-1",title:"Editar",onClick:r=>st(t)},e[38]||(e[38]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[l("path",{d:"M18 2a2.828 2.828 0 0 1 4 4L7 21l-4 1 1-4Z"}),l("path",{d:"m16 5 3 3"})],-1)]),8,$s)])):f("",!0)]))),128)),ne.value.length?f("",!0):(c(),p("tr",Rs,[l("td",{colspan:W.value?L.value?8:7:L.value?7:6,class:"text-center text-slate-500 py-6"},"Sin agentes",8,_s)]))])])])]),Ie.value?(c(),p("div",{key:0,class:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center p-4",onClick:C(re,["self"])},[l("div",Ms,[l("div",Ts,[l("div",Bs," Editar agente — "+g(j.value?.code),1),l("button",{class:"btn-ghost",onClick:re},"Cerrar")]),l("div",Us,[l("div",Ps,[l("div",null,[e[39]||(e[39]=l("label",{class:"label"},"Estado",-1)),A(l("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>v.value.state=t),class:"input"},[(c(),p(k,null,F($e,t=>l("option",{key:t,value:t},g(t),9,Fs)),64))],512),[[ie,v.value.state]])]),tt.value?(c(),p("div",qs,[e[41]||(e[41]=l("label",{class:"label"},"Municipio",-1)),xe(ze(Ke),{modelValue:v.value.municipio,"onUpdate:modelValue":e[9]||(e[9]=t=>v.value.municipio=t),options:Z.value,loading:Oe.value,"internal-search":!1,"clear-on-select":!0,"close-on-select":!0,"preserve-search":!0,"show-labels":!1,"allow-empty":!0,placeholder:"Escribe para buscar…",label:"label","track-by":"id",onSearchChange:it,class:"w-full"},{noResult:le(()=>e[40]||(e[40]=[M("Ningún municipio encontrado",-1)])),option:le(({option:t})=>[l("div",Hs,[l("span",null,g(t.label),1),l("span",Gs,"id: "+g(t.id),1)])]),singleLabel:le(({option:t})=>[l("span",null,g(t.label),1)]),_:1},8,["modelValue","options","loading"]),e[42]||(e[42]=l("div",{class:"text-xs text-slate-500 mt-1"},null,-1))])):f("",!0),Se.value?(c(),p("div",zs,[e[43]||(e[43]=l("label",{class:"label"},"Inicio",-1)),A(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>v.value.novelty_start=t),type:"date",class:"input"},null,512),[[J,v.value.novelty_start]])])):f("",!0),Se.value?(c(),p("div",js,[e[44]||(e[44]=l("label",{class:"label"},"Fin",-1)),A(l("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>v.value.novelty_end=t),type:"date",class:"input"},null,512),[[J,v.value.novelty_end]])])):v.value.state==="HOSPITALIZADO"?(c(),p("div",Ks,[e[45]||(e[45]=l("label",{class:"label"},"Inicio",-1)),A(l("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>v.value.novelty_start=t),type:"date",class:"input"},null,512),[[J,v.value.novelty_start]])])):f("",!0),Me.value?(c(),p("div",Zs,[e[46]||(e[46]=l("label",{class:"label"},"Descripción",-1)),A(l("textarea",{"onUpdate:modelValue":e[13]||(e[13]=t=>v.value.novelty_description=t),class:"input",rows:"2",placeholder:"Motivo / detalle..."},null,512),[[J,v.value.novelty_description]])])):f("",!0),v.value.state==="SERVICIO"?(c(),p("div",Xs," Para “SERVICIO” el municipio se fija automáticamente en Bogotá (11001). ")):f("",!0)]),l("div",Ys,[l("button",{class:"btn-ghost",onClick:re},"Cancelar"),l("button",{class:"btn-primary",onClick:lt,disabled:oe.value},g(oe.value?"Guardando...":"Guardar"),9,Qs)])])])])):f("",!0)],64)):(c(),p("div",ss,"No se encontró información para los parámetros."))])]),z.value.open?(c(),p("div",Js,[l("div",{class:"absolute inset-0 bg-black/40",onClick:e[14]||(e[14]=t=>z.value.open=!1)}),l("div",Ws,[l("div",ei,[l("div",ti,[l("div",si,[M(" Historial — "+g(z.value.agent?.code)+" ",1),z.value.agent?.nickname?(c(),p("span",ii,"("+g(z.value.agent.nickname)+")",1)):f("",!0)]),l("span",li,g(rt.value),1)]),l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium text-white hover:bg-white/10",onClick:e[15]||(e[15]=t=>z.value.open=!1)},"✕")]),l("div",ai,[l("div",ni,[l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:ut},"◀"),l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:ct},"Hoy"),l("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:dt},"▶"),l("span",oi,g(Fe.value)+" → "+g(qe.value),1)]),l("div",ri,[l("button",{class:_(["px-3 py-1.5 text-sm rounded-full",X.value==="calendar"?"bg-white shadow-sm text-slate-900 dark:bg-slate-900 dark:text-white":"text-slate-700 dark:text-slate-200"]),onClick:e[16]||(e[16]=t=>X.value="calendar")},"Calendario",2),l("button",{class:_(["px-3 py-1.5 text-sm rounded-full",X.value==="timeline"?"bg-white shadow-sm text-slate-900 dark:bg-slate-900 dark:text-white":"text-slate-700 dark:text-slate-200"]),onClick:e[17]||(e[17]=t=>X.value="timeline")},"Línea de tiempo",2)])]),l("div",ui,[X.value==="calendar"?(c(),p("div",di,[e[47]||(e[47]=wt('<div class="grid grid-cols-7 gap-2 text-xs font-medium text-slate-600 mb-1" data-v-cb8df672><div class="text-center" data-v-cb8df672>L</div><div class="text-center" data-v-cb8df672>M</div><div class="text-center" data-v-cb8df672>X</div><div class="text-center" data-v-cb8df672>J</div><div class="text-center" data-v-cb8df672>V</div><div class="text-center" data-v-cb8df672>S</div><div class="text-center" data-v-cb8df672>D</div></div>',1)),l("div",ci,[(c(!0),p(k,null,F(mt.value,t=>(c(),p("div",{key:t.key,title:t.title,class:_(["h-20 rounded-xl p-2 flex flex-col transition-all border border-slate-200 dark:border-slate-700 hover:shadow-md hover:-translate-y-[1px]",[t.state?ce(t.state)?.bg||"bg-slate-100":"bg-white dark:bg-slate-400/60",t.isToday&&"ring-2 ring-blue-500/70"]])},[l("div",hi,g(t.day||""),1),t.state?(c(),p("div",mi,g(Ee(t.state)),1)):f("",!0),t.state?(c(),p("div",vi,g(He(t.state)),1)):f("",!0)],10,pi))),128))])])):(c(),p("div",gi,[e[48]||(e[48]=l("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-gradient-to-b from-slate-300 via-slate-200 to-slate-300 dark:from-slate-700 dark:via-slate-800 dark:to-slate-700"},null,-1)),(c(!0),p(k,null,F(vt.value,(t,r)=>(c(),p("div",{key:r,class:"flex items-center gap-3 pl-4"},[l("div",{class:_(["w-3 h-3 rounded-full border-2 border-white shadow ring-1 ring-slate-200 dark:border-slate-900",ce(t.state)?.dot||"bg-slate-400"])},null,2),l("div",{class:_(["inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs shadow-sm",ce(t.state)?.pill||"bg-slate-100 text-slate-700"])},[M(g(Ee(t.state))+" ",1),l("span",null,[M(g(t.state)+" ",1),t.municipalityName?(c(),p(k,{key:0},[M(" — 📍 "+g(t.municipalityName),1)],64)):f("",!0)]),l("span",fi,"("+g(t.from)+" → "+g(t.to)+")",1),l("span",yi,"• "+g(t.count)+" día(s)",1)],2)]))),128))])),X.value==="calendar"?(c(),p("div",bi,[(c(),p(k,null,F(pt,t=>l("div",{key:t,class:_(["inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs shadow-sm",ce(t)?.pill||"bg-slate-100 text-slate-700"])},g(Ee(t))+" "+g(He(t)),3)),64))])):f("",!0)])])])):f("",!0)],64))}},Ci=It(Ii,[["__scopeId","data-v-cb8df672"]]);export{Ci as default};
