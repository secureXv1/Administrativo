import{c,o as p,r as L,a as i,b as Ot,w as E,d as Le,e as y,f as N,v as he,F as x,g as F,t as v,h as H,i as le,T as Ge,n as Ne,j as U,k as B,l as Ct,_ as Et,m as O,p as D,u as Dt,q as At,s as J,x as Nt,y as ze,z as X,A as se,B as wt,C as kt,D as V,E as we,G as xt,H as Lt}from"./index-D4ZEw6CO.js";function ke(s){return s===0?!1:Array.isArray(s)&&s.length===0?!0:!s}function Vt(s){return(...a)=>!s(...a)}function $t(s,a){return s===void 0&&(s="undefined"),s===null&&(s="null"),s===!1&&(s="false"),s.toString().toLowerCase().indexOf(a.trim())!==-1}function Rt(s){return s.filter(a=>!a.$isLabel)}function xe(s,a){return r=>r.reduce((I,b)=>b[s]&&b[s].length?(I.push({$groupLabel:b[a],$isLabel:!0}),I.concat(b[s])):I,[])}const je=(...s)=>a=>s.reduce((r,I)=>I(r),a);var Mt={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(s,a){return ke(s)?"":a?s[a]:s}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max&&console.warn("[Vue-Multiselect warn]: Max prop should not be used when prop Multiple equals false."),this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||this.modelValue===0?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const s=this.search||"",a=s.toLowerCase().trim();let r=this.options.concat();return this.internalSearch?r=this.groupValues?this.filterAndFlat(r,a,this.label):this.filterOptions(r,a,this.label,this.customLabel):r=this.groupValues?xe(this.groupValues,this.groupLabel)(r):r,r=this.hideSelected?r.filter(Vt(this.isSelected)):r,this.taggable&&a.length&&!this.isExistingOption(a)&&(this.tagPosition==="bottom"?r.push({isTag:!0,label:s}):r.unshift({isTag:!0,label:s})),r.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map(s=>s[this.trackBy]):this.internalValue},optionKeys(){return(this.groupValues?this.flatAndStrip(this.options):this.options).map(a=>this.customLabel(a,this.label).toString().toLowerCase())},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:this.internalValue.length===0?null:this.internalValue[0]},filterAndFlat(s,a,r){return je(this.filterGroups(a,r,this.groupValues,this.groupLabel,this.customLabel),xe(this.groupValues,this.groupLabel))(s)},flatAndStrip(s){return je(xe(this.groupValues,this.groupLabel),Rt)(s)},updateSearch(s){this.search=s},isExistingOption(s){return this.options?this.optionKeys.indexOf(s)>-1:!1},isSelected(s){const a=this.trackBy?s[this.trackBy]:s;return this.valueKeys.indexOf(a)>-1},isOptionDisabled(s){return!!s.$isDisabled},getOptionLabel(s){if(ke(s))return"";if(s.isTag)return s.label;if(s.$isLabel)return s.$groupLabel;const a=this.customLabel(s,this.label);return ke(a)?"":a},select(s,a){if(s.$isLabel&&this.groupSelect){this.selectGroup(s);return}if(!(this.blockKeys.indexOf(a)!==-1||this.disabled||s.$isDisabled||s.$isLabel)&&!(this.max&&this.multiple&&this.internalValue.length===this.max)&&!(a==="Tab"&&!this.pointerDirty)){if(s.isTag)this.$emit("tag",s.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{if(this.isSelected(s)){a!=="Tab"&&this.removeElement(s);return}this.multiple?this.$emit("update:modelValue",this.internalValue.concat([s])):this.$emit("update:modelValue",s),this.$emit("select",s,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(s){const a=this.options.find(r=>r[this.groupLabel]===s.$groupLabel);if(a){if(this.wholeGroupSelected(a)){this.$emit("remove",a[this.groupValues],this.id);const r=this.trackBy?a[this.groupValues].map(b=>b[this.trackBy]):a[this.groupValues],I=this.internalValue.filter(b=>r.indexOf(this.trackBy?b[this.trackBy]:b)===-1);this.$emit("update:modelValue",I)}else{const r=a[this.groupValues].filter(I=>!(this.isOptionDisabled(I)||this.isSelected(I)));this.max&&r.splice(this.max-this.internalValue.length),this.$emit("select",r,this.id),this.$emit("update:modelValue",this.internalValue.concat(r))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(s){return s[this.groupValues].every(a=>this.isSelected(a)||this.isOptionDisabled(a))},wholeGroupDisabled(s){return s[this.groupValues].every(this.isOptionDisabled)},removeElement(s,a=!0){if(this.disabled||s.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1){this.deactivate();return}const r=typeof s=="object"?this.valueKeys.indexOf(s[this.trackBy]):this.valueKeys.indexOf(s);if(this.multiple){const I=this.internalValue.slice(0,r).concat(this.internalValue.slice(r+1));this.$emit("update:modelValue",I)}else this.$emit("update:modelValue",null);this.$emit("remove",s,this.id),this.closeOnSelect&&a&&this.deactivate()},removeLastElement(){this.blockKeys.indexOf("Delete")===-1&&this.search.length===0&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&this.pointer===0&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick(()=>this.$refs.search&&this.$refs.search.focus())):this.preventAutofocus||typeof this.$el<"u"&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?this.$refs.search!==null&&typeof this.$refs.search<"u"&&this.$refs.search.blur():typeof this.$el<"u"&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if(typeof window>"u")return;const s=this.$el.getBoundingClientRect().top,a=window.innerHeight-this.$el.getBoundingClientRect().bottom;a>this.maxHeight||a>s||this.openDirection==="below"||this.openDirection==="bottom"?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(a-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(s-40,this.maxHeight))},filterOptions(s,a,r,I){return a?s.filter(b=>$t(I(b,r),a)).sort((b,d)=>typeof this.filteringSortFunc=="function"?this.filteringSortFunc(b,d):I(b,r).length-I(d,r).length):s},filterGroups(s,a,r,I,b){return d=>d.map(u=>{if(!u[r])return console.warn("Options passed to vue-multiselect do not contain groups, despite the config."),[];const A=this.filterOptions(u[r],s,a,b);return A.length?{[I]:u[I],[r]:A}:[]})}}},Tt={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(s,a){return{"multiselect__option--highlight":s===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(a)}},groupHighlight(s,a){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":a.$isLabel}];const r=this.options.find(I=>I[this.groupLabel]===a.$groupLabel);return r&&!this.wholeGroupDisabled(r)?["multiselect__option--group",{"multiselect__option--highlight":s===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(r)}]:"multiselect__option--disabled"},addPointerElement({key:s}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],s),this.pointerReset()},pointerForward(){this.pointer<this.filteredOptions.length-1&&(this.pointer++,this.$refs.list?.scrollTop<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){this.pointer>0?(this.pointer--,this.$refs.list?.scrollTop>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(s){this.pointer=s,this.pointerDirty=!0}}},Ke={name:"vue-multiselect",mixins:[Mt,Tt],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:s=>`and ${s} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1},useTeleport:{type:Boolean,default:!1}},data(){return{dropdownStyles:{},ready:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||this.singleValue===0)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return this.openDirection==="above"||this.openDirection==="top"?!0:this.openDirection==="below"||this.openDirection==="bottom"?!1:this.preferredOpenDirection==="above"},showSearchInput(){return this.searchable&&(this.hasSingleSelectedSlot&&(this.visibleSingleValue||this.visibleSingleValue===0)?this.isOpen:!0)},isRequired(){return this.required===!1?!1:this.internalValue.length<=0}},watch:{isOpen(s){s&&(this.useTeleport?(this.ready=!1,this.$nextTick(()=>{const a=this.$el.getBoundingClientRect();this.dropdownStyles={position:"absolute",top:`${a.bottom+window.scrollY}px`,left:`${a.left+window.scrollX}px`,width:`${a.width}px`,zIndex:9999},this.ready=!0})):this.ready=!0)}}};const _t=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],Bt={ref:"tags",class:"multiselect__tags"},Ut={class:"multiselect__tags-wrap"},Pt=["textContent"],qt=["onKeypress","onMousedown"],Ft=["textContent"],Ht={class:"multiselect__spinner"},Gt=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],zt=["id","aria-multiselectable"],jt={key:0},Kt={class:"multiselect__option"},Zt=["aria-selected","id","role"],Xt=["onClick","onMouseenter","data-select","data-selected","data-deselect"],Yt=["data-select","data-deselect","onMouseenter","onMousedown"],Qt={class:"multiselect__option"},Wt={class:"multiselect__option"};function Jt(s,a,r,I,b,d){return p(),c("div",{tabindex:s.searchable?-1:r.tabindex,class:B([{"multiselect--active":s.isOpen,"multiselect--disabled":r.disabled,"multiselect--above":d.isAbove,"multiselect--has-options-group":d.hasOptionGroup},"multiselect"]),onFocus:a[14]||(a[14]=u=>s.activate()),onBlur:a[15]||(a[15]=u=>s.searchable?!1:s.deactivate()),onKeydown:[a[16]||(a[16]=H(E(u=>s.pointerForward(),["self","prevent"]),["down"])),a[17]||(a[17]=H(E(u=>s.pointerBackward(),["self","prevent"]),["up"]))],onKeypress:a[18]||(a[18]=H(E(u=>s.addPointerElement(u),["stop","self"]),["enter","tab"])),onKeyup:a[19]||(a[19]=H(u=>s.deactivate(),["esc"])),role:"combobox","aria-expanded":s.isOpen,"aria-owns":"listbox-"+s.id,"aria-activedescendant":s.isOpen&&s.pointer!==null?s.id+"-"+s.pointer:null},[L(s.$slots,"caret",{toggle:s.toggle},()=>[i("div",{onMousedown:a[0]||(a[0]=E(u=>s.toggle(),["prevent","stop"])),class:"multiselect__select"},null,32)]),L(s.$slots,"clear",{search:s.search}),i("div",Bt,[L(s.$slots,"selection",{search:s.search,remove:s.removeElement,values:d.visibleValues,isOpen:s.isOpen},()=>[N(i("div",Ut,[(p(!0),c(x,null,F(d.visibleValues,(u,A)=>L(s.$slots,"tag",{option:u,search:s.search,remove:s.removeElement},()=>[(p(),c("span",{class:"multiselect__tag",key:A,onMousedown:a[1]||(a[1]=E(()=>{},["prevent"]))},[i("span",{textContent:v(s.getOptionLabel(u))},null,8,Pt),i("i",{tabindex:"1",onKeypress:H(E(P=>s.removeElement(u),["prevent"]),["enter"]),onMousedown:E(P=>s.removeElement(u),["prevent"]),class:"multiselect__tag-icon"},null,40,qt)],32))])),256))],512),[[he,d.visibleValues.length>0]]),s.internalValue&&s.internalValue.length>r.limit?L(s.$slots,"limit",{key:0},()=>[i("strong",{class:"multiselect__strong",textContent:v(r.limitText(s.internalValue.length-r.limit))},null,8,Ft)]):y("v-if",!0)]),Le(Ge,{name:"multiselect__loading"},{default:le(()=>[L(s.$slots,"loading",{},()=>[N(i("div",Ht,null,512),[[he,r.loading]])])]),_:3}),s.searchable?(p(),c("input",{key:0,ref:"search",name:r.name,id:s.id,type:"text",autocomplete:"off",spellcheck:r.spellcheck,placeholder:s.placeholder,required:d.isRequired,style:Ne(d.inputStyle),value:s.search,disabled:r.disabled,tabindex:r.tabindex,"aria-label":r.name+"-searchbox",onInput:a[2]||(a[2]=u=>s.updateSearch(u.target.value)),onFocus:a[3]||(a[3]=E(u=>s.activate(),["prevent"])),onBlur:a[4]||(a[4]=E(u=>s.deactivate(),["prevent"])),onKeyup:a[5]||(a[5]=H(u=>s.deactivate(),["esc"])),onKeydown:[a[6]||(a[6]=H(E(u=>s.pointerForward(),["prevent"]),["down"])),a[7]||(a[7]=H(E(u=>s.pointerBackward(),["prevent"]),["up"])),a[9]||(a[9]=H(E(u=>s.removeLastElement(),["stop"]),["delete"]))],onKeypress:a[8]||(a[8]=H(E(u=>s.addPointerElement(u),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+s.id},null,44,Gt)):y("v-if",!0),d.isSingleLabelVisible?(p(),c("span",{key:1,class:"multiselect__single",onMousedown:a[10]||(a[10]=E((...u)=>s.toggle&&s.toggle(...u),["prevent"]))},[L(s.$slots,"singleLabel",{option:d.singleValue},()=>[U(v(s.currentOptionLabel),1)])],32)):y("v-if",!0),d.isPlaceholderVisible?(p(),c("span",{key:2,class:"multiselect__placeholder",onMousedown:a[11]||(a[11]=E((...u)=>s.toggle&&s.toggle(...u),["prevent"]))},[L(s.$slots,"placeholder",{},()=>[U(v(s.placeholder),1)])],32)):y("v-if",!0)],512),(p(),Ot(Ct,{to:"body",disabled:!r.useTeleport},[Le(Ge,{name:"multiselect"},{default:le(()=>[s.isOpen&&b.ready?(p(),c("div",{key:0,class:"multiselect__content-wrapper",onFocus:a[12]||(a[12]=(...u)=>s.activate&&s.activate(...u)),tabindex:"-1",onMousedown:a[13]||(a[13]=E(()=>{},["prevent"])),style:Ne([b.dropdownStyles,{maxHeight:s.optimizedHeight+"px"}]),ref:"list"},[i("ul",{class:"multiselect__content",style:Ne(d.contentStyle),role:"listbox",id:"listbox-"+s.id,"aria-multiselectable":s.multiple},[L(s.$slots,"beforeList"),s.multiple&&s.max===s.internalValue.length?(p(),c("li",jt,[i("span",Kt,[L(s.$slots,"maxElements",{},()=>[U("Maximum of "+v(s.max)+" options selected. First remove a selected option to select another.",1)])])])):y("v-if",!0),!s.max||s.internalValue.length<s.max?(p(!0),c(x,{key:1},F(s.filteredOptions,(u,A)=>(p(),c("li",{class:"multiselect__element",key:A,"aria-selected":s.isSelected(u),id:s.id+"-"+A,role:u&&(u.$isLabel||u.$isDisabled)?null:"option"},[u&&(u.$isLabel||u.$isDisabled)?y("v-if",!0):(p(),c("span",{key:0,class:B([s.optionHighlight(A,u),"multiselect__option"]),onClick:E(P=>s.select(u),["stop"]),onMouseenter:E(P=>s.pointerSet(A),["self"]),"data-select":u&&u.isTag?s.tagPlaceholder:d.selectLabelText,"data-selected":d.selectedLabelText,"data-deselect":d.deselectLabelText},[L(s.$slots,"option",{option:u,search:s.search,index:A},()=>[i("span",null,v(s.getOptionLabel(u)),1)])],42,Xt)),u&&(u.$isLabel||u.$isDisabled)?(p(),c("span",{key:1,"data-select":s.groupSelect&&d.selectGroupLabelText,"data-deselect":s.groupSelect&&d.deselectGroupLabelText,class:B([s.groupHighlight(A,u),"multiselect__option"]),onMouseenter:E(P=>s.groupSelect&&s.pointerSet(A),["self"]),onMousedown:E(P=>s.selectGroup(u),["prevent"])},[L(s.$slots,"option",{option:u,search:s.search,index:A},()=>[i("span",null,v(s.getOptionLabel(u)),1)])],42,Yt)):y("v-if",!0)],8,Zt))),128)):y("v-if",!0),N(i("li",null,[i("span",Qt,[L(s.$slots,"noResult",{search:s.search},()=>[a[20]||(a[20]=U("No elements found. Consider changing the search query."))])])],512),[[he,r.showNoResults&&s.filteredOptions.length===0&&s.search&&!r.loading]]),N(i("li",null,[i("span",Wt,[L(s.$slots,"noOptions",{},()=>[a[21]||(a[21]=U("List is empty."))])])],512),[[he,r.showNoOptions&&(s.options.length===0||d.hasOptionGroup===!0&&s.filteredOptions.length===0)&&!s.search&&!r.loading]]),L(s.$slots,"afterList")],12,zt)],36)):y("v-if",!0)]),_:3})],8,["disabled"]))],42,_t)}Ke.render=Jt;const es={class:"max-w-9xl mx-auto space-y-6"},ts={class:"sticky top-0 z-10 bg-white/70 backdrop-blur border-b border-slate-200"},ss={class:"max-w-9xl mx-auto px-4 py-3 flex items-center justify-between"},ls={class:"flex items-center gap-3"},is={class:"font-semibold text-slate-900"},as={class:"max-w-9xl mx-auto px-2 sm:px-4 py-6 space-y-4"},ns={key:0,class:"text-center py-12 text-brand-700 font-semibold"},os={key:1,class:"text-center py-12 text-gray-500"},rs={class:"card mb-3"},us={class:"card-body grid grid-cols-1 sm:grid-cols-6 gap-3 sm:items-end"},ds=["disabled"],ps={key:0,value:"all"},cs=["value"],hs={class:"sm:col-span-3"},ms=["value"],vs={key:0,class:"text-xs text-slate-500 mt-1"},gs={class:"card"},fs={class:"card-body"},ys={class:"grid grid-cols-1 sm:grid-cols-6 gap-2 sm:items-end"},bs=["value"],Is={class:"flex items-center gap-2 mt-2 sm:mt-0"},Ss={class:"mt-4 flex flex-wrap gap-2"},Os={class:"card"},Cs={class:"card-body overflow-x-auto p-0"},Es={class:"table min-w-full text-xs sm:text-sm"},Ds={key:0},As={key:1},Ns={key:2,class:"text-center"},ws={class:"font-medium text-slate-900"},ks={key:0},xs={class:"text-slate-700"},Ls={key:1},Vs={class:"text-slate-700"},$s=["title"],Rs={key:2,class:"text-slate-300"},Ms=["title"],Ts={key:2,class:"text-right"},_s=["onClick"],Bs={key:3,class:"text-right"},Us=["onClick"],Ps={key:0},qs=["colspan"],Fs={class:"bg-white rounded-xl shadow max-w-2xl w-full"},Hs={class:"p-4 border-b flex items-center justify-between"},Gs={class:"font-semibold text-slate-800"},zs={class:"p-4 space-y-4"},js={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},Ks=["value"],Zs={key:0,class:"sm:col-span-2"},Xs={class:"flex items-center justify-between w-full"},Ys={class:"text-xs text-slate-400"},Qs={key:1},Ws={key:2},Js={key:3},el={key:4,class:"sm:col-span-3"},tl={key:5,class:"sm:col-span-3 text-xs text-slate-500"},sl={class:"flex justify-end gap-2 pt-2"},ll=["disabled"],il={key:0,class:"fixed inset-0 z-[9998] grid place-items-center p-4"},al={class:"relative z-10 w-full max-w-5xl rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-200"},nl={class:"px-5 py-4 rounded-t-2xl text-white flex items-center justify-between bg-gradient-to-r from-slate-900 via-indigo-700 to-blue-600 dark:from-slate-950 dark:via-indigo-900 dark:to-blue-800"},ol={class:"flex items-center gap-3"},rl={class:"text-xl font-semibold tracking-tight"},ul={key:0,class:"opacity-80 text-sm"},dl={class:"inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs bg-white/15 text-white"},pl={class:"px-5 py-3 flex flex-wrap items-center gap-3"},cl={class:"flex items-center gap-2"},hl={class:"inline-flex items-center gap-1 rounded-full border border-slate-300 bg-white px-3 py-1 text-xs text-slate-700 dark:bg-slate-800 dark:text-slate-200 dark:border-slate-700"},ml={class:"ml-auto inline-flex rounded-full p-1 bg-slate-200/70 dark:bg-slate-700/60"},vl={class:"px-5 pb-5 max-h-[70vh] overflow-auto"},gl={key:0},fl={class:"grid grid-cols-7 gap-2"},yl=["title"],bl={class:"text-[11px] font-medium opacity-60"},Il={key:0,class:"mt-auto text-center text-lg leading-none"},Sl={key:1,class:"text-[11px] text-center truncate mt-1 opacity-85"},Ol={key:1,class:"space-y-4 relative"},Cl={class:"opacity-70"},El={class:"opacity-70"},Dl={key:2,class:"mt-5 flex flex-wrap gap-2 text-xs"},Al={__name:"AdminReportDetail",setup(s){const a=O([]);async function r(){try{const{data:l}=await V.get("/admin/groups",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});a.value=Array.isArray(l)?l:[]}catch{a.value=[]}}const I=D(()=>P.value&&P.value.role==="leader_group"),b=O("all"),d=Dt(),u=At(),A={id:11001,name:"BOGOT√Å, D.C.",dept:"BOGOT√Å, D.C.",label(){return`${this.name} (${this.dept})`}},P=O(null);async function Ze(){try{const{data:l}=await V.get("/me",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});P.value=l}catch{P.value=null}}const Y=D(()=>{const l=String(P.value?.role||"").toLowerCase();return["leader_group","superadmin","supervision","supervisor"].includes(l)}),Ve=D(()=>d.params.id?String(d.params.id):null),me=D(()=>d.query.date?String(d.query.date):new Date().toISOString().slice(0,10)),$=D(()=>d.query.groupId?String(d.query.groupId):null),$e=O(!1),R=D(()=>$e.value||!!$.value),ve=O(!0),q=O({groupCode:"",unitName:"",date:"‚Äî"}),w=O(!1),M=O([]),Re=O([]),k=O({...{q:"",category:"ALL",state:"ALL",unitId:"ALL",onlyNovelties:!1}}),Me=["SIN NOVEDAD","SERVICIO","COMISI√ìN DEL SERVICIO","FRANCO FRANCO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","DESCANSO ESPECIAL","PERMISO ACTIVIDAD PERSONAL","COMISI√ìN EN EL EXTERIOR","COMISI√ìN DE ESTUDIO","SUSPENDIDO","HOSPITALIZADO"],C=O(me.value),T=O(String(d.query.unitId||"")),z=O([]);function Q(){const l=new Date,e=String(l.getMonth()+1).padStart(2,"0"),t=String(l.getDate()).padStart(2,"0");return`${l.getFullYear()}-${e}-${t}`}async function ie(l){try{const e={date_from:l,date_to:l};R.value&&$.value&&(e.groupId=$.value);const{data:t}=await V.get("/dashboard/reports",{params:e,headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),n=Array.isArray(t?.items)?t.items:[],m=new Map;for(const o of n)if(o.unitId&&o.unitName){const f=String(o.unitId);m.has(f)||m.set(f,{id:f,name:o.unitName})}z.value=Array.from(m.values()).sort((o,f)=>String(o.name||"").localeCompare(String(f.name||"")));const g=String(d.query.unitId||"");if(g){if(T.value=g,!z.value.some(o=>String(o.id)===g))try{const{data:o}=await V.get(`/admin/units/${g}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});o?.id?z.value.unshift({id:String(o.id),name:o.name||`Unidad ${o.id}`}):z.value.unshift({id:g,name:`Unidad ${g}`})}catch{z.value.unshift({id:g,name:`Unidad ${g}`})}}else T.value=""}catch(e){console.error("loadUnitsIndex error",e),z.value=[]}}async function ae(l,e){try{const t=String(e??"").trim(),n=/^\d+$/.test(t)?Number(t):t,m={date_from:l,date_to:l,unitId:n};R.value&&$.value&&(m.groupId=$.value);const{data:g}=await V.get("/dashboard/reports",{params:m,headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let o=Array.isArray(g?.items)?g.items:[];if(o.length&&(o=o.filter(S=>String(S.unitId)===String(n))),!o.length){await u.replace({name:d.name,params:d.params,query:{...d.query,unitId:String(n||""),date:l}});return}const f=o.sort((S,te)=>String(S.id).localeCompare(String(te.id))).pop();await u.replace({name:d.name,params:{id:String(f.id)},query:{...d.query,unitId:String(n),date:l}}),w.value=!1,M.value=[],await fe(String(f.id)),q.value={...q.value,date:l},w.value=!0}catch(t){console.warn("gotoReportForUnit error:",t?.message||t),await u.replace({name:d.name,params:d.params,query:{...d.query,unitId:String(e||""),date:l}})}}async function Xe(){const l=C.value||Q();await ie(l),T.value?await ae(l,T.value):(R.value&&$.value?await ee(l,$.value):await ne(l),await u.replace({name:d.name,params:d.params,query:{...d.query,date:l,unitId:""}}),q.value={...q.value,date:l})}async function Te(){const l=C.value||Q(),e=T.value;if(!e){R.value&&$.value&&await ee(l,$.value),await u.replace({name:d.name,params:d.params,query:{...d.query,date:l,unitId:""}});return}await ae(l,e)}J(()=>d.query,async l=>{const e=String(l.date||Q()),t=String(l.unitId||"");(e!==C.value||t!==T.value)&&(C.value=e,T.value=t,await ie(e),t?await ae(e,t):R.value&&$.value?await ee(e,$.value):await ne(e))}),J(()=>d.query.groupId,l=>{l&&String(b.value)!==String(l)&&(b.value=String(l)),!l&&b.value!=="all"&&(b.value="all")});function ge(l){if(!l)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(l)){const[g,o,f]=l.split("-");return`${f}/${o}/${g}`}const e=new Date(l);if(isNaN(e))return"";const t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),m=e.getFullYear();return`${t}/${n}/${m}`}function Ye(l){return String(l||"").toUpperCase()==="SO"?"ME":l}function Qe(l){const e=String(l||"").toUpperCase();return e==="SIN NOVEDAD"?"bg-green-50 text-green-700 border-green-200":e==="SERVICIO"||e==="COMISI√ìN DEL SERVICIO"?"bg-sky-50 text-sky-700 border-sky-200":"bg-amber-50 text-amber-800 border-amber-200"}async function fe(l){try{w.value=!1,M.value=[];const{data:e}=await V.get(`/admin/report-agents/${l}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),t=o=>({...o,_key:`${o.code}-${o.unitName||""}-${o.state}-${o.novelty_start||""}-${o.novelty_end||""}`,municipality:o.municipalityName&&o.dept?`${o.municipalityName} (${o.dept})`:o.municipalityName||"",municipalityName:o.municipalityName||null,municipalityDept:o.dept||null,municipalityId:o.municipalityId!=null?Number(o.municipalityId):null,novelty_description:o.novelty_description||o.descripcion,reportId:l,mt:o.mt??""}),n=(Array.isArray(e)?e:[]).map(t);M.value=n;const m=n[0],g=C.value||me.value;q.value={groupCode:m?.groupCode||"",unitName:m?.unitName||"",date:g},w.value=!0,setTimeout(()=>{ye().catch(()=>{})},0)}catch(e){console.error("loadSingleReport error:",e),w.value=!1,M.value=[]}}function We(l){return String(l||"").toUpperCase()==="PERMISO ACTIVIDAD PERSONAL"?"PERMISO":l}async function ee(l,e){try{w.value=!1,M.value=[];const{data:t}=await V.get("/dashboard/reports",{params:{date_from:l,date_to:l,groupId:e},headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),n=Array.isArray(t?.items)?t.items:[];if(!n.length){w.value=!1;return}q.value={groupCode:n[0].groupCode,unitName:"",date:l},Re.value=[...new Map(n.map(g=>[String(g.unitName||""),{id:g.unitId,name:g.unitName}])).values()].filter(g=>!!g.id).sort((g,o)=>(g.name||"").localeCompare(o.name||""));const m=[];for(const g of n){const{data:o}=await V.get(`/admin/report-agents/${g.id}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),f=(Array.isArray(o)?o:[]).map(S=>({...S,_key:`${S.code}-${S.unitName||""}-${S.state}-${S.novelty_start||""}-${S.novelty_end||""}`,municipality:S.municipalityName&&S.dept?`${S.municipalityName} (${S.dept})`:S.municipalityName||"",municipalityName:S.municipalityName||null,municipalityDept:S.dept||null,municipalityId:S.municipalityId!=null?Number(S.municipalityId):null,novelty_description:S.novelty_description||S.descripcion,reportId:g.id,mt:S.mt??""}));m.push(...f)}M.value=m,w.value=!0,setTimeout(()=>{ye().catch(()=>{})},0)}catch(t){console.error("loadGroupReports error:",t),w.value=!1,M.value=[]}}function Je(l){const e=["SIN NOVEDAD","SERVICIO","COMISI√ìN DEL SERVICIO","PERMISO ACTIVIDAD PERSONAL"];let t=0;for(let n=l.length-1;n>=0;n--){const m=String(l[n]?.state||"").toUpperCase();if(e.includes(m))t++;else break}return t}async function ye(){const l=C.value||Q();for(const e of M.value)try{const{data:t}=await V.get(`/admin/agents/${e.agentId||e.id}/history`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")},params:{from:"2020-01-01",to:l}}),n=Array.isArray(t?.items)?t.items:[];e.diasLaborados=Je(n,l)}catch{e.diasLaborados=0}}async function ne(l){try{w.value=!1,M.value=[];const{data:e}=await V.get("/dashboard/reports",{params:{date_from:l,date_to:l},headers:{Authorization:"Bearer "+(localStorage.getItem("token")||"")}}),t=Array.isArray(e?.items)?e.items:[],n=[];for(const m of t){const{data:g}=await V.get(`/admin/report-agents/${m.id}`,{headers:{Authorization:"Bearer "+(localStorage.getItem("token")||"")}}),o=(Array.isArray(g)?g:[]).map(f=>({...f,_key:`${f.code}-${f.unitName||""}-${f.state}-${f.novelty_start||""}-${f.novelty_end||""}`,municipality:f.municipalityName&&f.dept?`${f.municipalityName} (${f.dept})`:f.municipalityName||"",municipalityName:f.municipalityName||null,municipalityDept:f.dept||null,municipalityId:f.municipalityId!=null?Number(f.municipalityId):null,novelty_description:f.novelty_description||f.descripcion,reportId:m.id,mt:f.mt??""}));n.push(...o)}M.value=n,q.value={groupCode:"Todos",unitName:"",date:l},w.value=!0,setTimeout(()=>{ye().catch(()=>{})},0)}catch(e){console.error("loadAllReports error:",e),w.value=!1,M.value=[]}}const oe=D(()=>{let l=M.value.slice();const e=k.value.q.trim().toUpperCase();if(e&&(l=l.filter(t=>{const n=String(t.code||"").toUpperCase(),m=String(t.nickname||"").toUpperCase(),g=String(t.novelty_description||"").toUpperCase(),o=String(t.unitName||"").toUpperCase(),f=String(t.mission||"").toUpperCase();return n.includes(e)||m.includes(e)||g.includes(e)||o.includes(e)||f.includes(e)})),k.value.category!=="ALL"&&(l=l.filter(t=>String(t.category)===k.value.category)),k.value.state!=="ALL"&&(l=l.filter(t=>String(t.state).toUpperCase()===k.value.state)),k.value.onlyNovelties&&(l=l.filter(t=>String(t.state).toUpperCase()!=="SIN NOVEDAD")),R.value&&k.value.unitId!=="ALL"){const t=Re.value.find(n=>String(n.id)===String(k.value.unitId))?.name||"";l=l.filter(n=>String(n.unitName||"")===t)}return l.sort((t,n)=>{const m=Number(t.rank_order??9999),g=Number(n.rank_order??9999);return m!==g?m-g:String(t.code).localeCompare(String(n.code))})}),et=D(()=>{const l={"SIN NOVEDAD":0,SERVICIO:0,"COMISI√ìN DEL SERVICIO":0,otros:0};for(const e of oe.value){const t=String(e.state).toUpperCase();t==="SIN NOVEDAD"?l["SIN NOVEDAD"]++:t==="SERVICIO"?l.SERVICIO++:t==="COMISI√ìN DEL SERVICIO"?l["COMISI√ìN DEL SERVICIO"]++:l.otros++}return[{key:"sn",label:"Sin novedad",count:l["SIN NOVEDAD"],cls:"bg-green-50 text-green-700 border-green-200",dot:"bg-green-600"},{key:"srv",label:"Servicio",count:l.SERVICIO,cls:"bg-sky-50 text-sky-700 border-sky-200",dot:"bg-sky-600"},{key:"cds",label:"Comisi√≥n del servicio",count:l["COMISI√ìN DEL SERVICIO"],cls:"bg-sky-50 text-sky-700 border-sky-200",dot:"bg-sky-600"},{key:"oth",label:"Otros",count:l.otros,cls:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-600"}]}),be=O(!1),j=O(null),re=O(!1),h=O({state:"SIN NOVEDAD",municipio:null,novelty_start:"",novelty_end:"",novelty_description:""}),Ie=D(()=>["SERVICIO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","DESCANSO ESPECIAL","PERMISO ACTIVIDAD PERSONAL","COMISI√ìN EN EL EXTERIOR","COMISI√ìN DE ESTUDIO","SUSPENDIDO"].includes(h.value.state)),_e=D(()=>["SERVICIO","VACACIONES","LICENCIA DE MATERNIDAD","LICENCIA DE LUTO","LICENCIA REMUNERADA","LICENCIA NO REMUNERADA","EXCUSA DEL SERVICIO","LICENCIA PATERNIDAD","PERMISO","DESCANSO ESPECIAL","PERMISO ACTIVIDAD PERSONAL","COMISI√ìN EN EL EXTERIOR","COMISI√ìN DE ESTUDIO","COMISI√ìN DEL SERVICIO","SUSPENDIDO","HOSPITALIZADO"].includes(h.value.state)),tt=D(()=>h.value.state==="COMISI√ìN DEL SERVICIO");function st(l){if(!Y.value)return;j.value=l;const e=String(l.state||"").toUpperCase(),t=e==="COMISI√ìN DEL SERVICIO";let n=null;if(t){const m=l.municipalityId!=null?Number(l.municipalityId):null,g=l.municipalityName||null,o=l.municipalityDept||null;m&&(n=Be(m,g,o))}h.value={state:e,municipio:n,novelty_start:l.novelty_start||"",novelty_end:l.novelty_end||"",novelty_description:l.novelty_description||"",mt:l.mt??""},be.value=!0}J(()=>h.value.state,l=>{if(String(l||"").toUpperCase()!=="COMISI√ìN DEL SERVICIO")h.value.municipio=null;else{const t=j.value;t?.municipalityId&&!h.value.municipio&&(h.value.municipio=Be(t.municipalityId,t.municipalityName,t.municipalityDept))}});function ue(){be.value=!1,j.value=null}const K=O([]),Se=O(!1);let Oe=null;async function lt(l){Oe&&clearTimeout(Oe),Oe=setTimeout(async()=>{const e=String(l||"").trim();if(e.length<2){K.value=[];return}Se.value=!0;try{const{data:t}=await V.get("/catalogs/municipalities",{params:{q:e,limit:15},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});K.value=(t||[]).map(n=>({id:n.id,label:`${n.name} (${n.dept})`}))}catch{K.value=[]}finally{Se.value=!1}},250)}function Be(l,e,t){if(!l)return null;const n=Number(l);let m=K.value.find(g=>Number(g.id)===n);return m||(m={id:n,label:e?`${e} (${t||""})`:`id ${n}`},K.value=[m,...K.value]),m}async function it(){if(j.value){if(h.value.state==="COMISI√ìN DEL SERVICIO"&&!h.value.municipio?.id){alert("Selecciona un municipio para Comisi√≥n del servicio");return}if(h.value.state==="COMISI√ìN DEL SERVICIO"&&!h.value.novelty_description?.trim()){alert("La descripci√≥n es requerida para Comisi√≥n del servicio");return}if(h.value.state==="HOSPITALIZADO"){if(!h.value.novelty_start){alert("Falta fecha de inicio (HOSPITALIZADO)");return}if(!h.value.novelty_description?.trim()){alert("Falta descripci√≥n (HOSPITALIZADO)");return}}if(Ie.value&&(!h.value.novelty_start||!h.value.novelty_end)){alert("Completa las fechas de la novedad (inicio y fin)");return}if(_e.value&&!h.value.novelty_description?.trim()){alert("La descripci√≥n es requerida para este estado");return}re.value=!0;try{const l=h.value.state==="HOSPITALIZADO";await V.put(`/admin/report-agents/${j.value.reportId}/${j.value.agentId}`,{state:h.value.state,municipalityId:h.value.state==="COMISI√ìN DEL SERVICIO"?h.value.municipio?.id||null:["SERVICIO","SIN NOVEDAD"].includes(h.value.state)?A.id:null,novelty_start:h.value.novelty_start||null,novelty_end:l?null:h.value.novelty_end||null,novelty_description:h.value.novelty_description||null},{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});let e=null,t=null,n=null,m="";if(h.value.state==="COMISI√ìN DEL SERVICIO"){if(e=h.value.municipio?.id||null,h.value.municipio?.label){const g=h.value.municipio.label.split(" (");t=g[0]||null,n=g[1]?g[1].replace(/\)$/,""):null,m=h.value.municipio.label}}else["SERVICIO","SIN NOVEDAD"].includes(h.value.state)&&(e=A.id,t=A.name,n=A.dept,m=A.label());Object.assign(j.value,{state:h.value.state,municipalityId:e,municipalityName:t,municipalityDept:n,municipality:m||(t?`${t} (${n||""})`:"N/A"),novelty_start:h.value.novelty_start||null,novelty_end:l?null:h.value.novelty_end||null,novelty_description:h.value.novelty_description||null,mt:(h.value.mt??"").toString().trim()||null}),ue()}catch(l){alert(l?.response?.data?.detail||l?.response?.data?.error||"No se pudo guardar")}finally{re.value=!1}}}async function at(){const l=oe.value.map(m=>({codigo:m.code,categoria:m.category,unidad:m.unitName||"",estado:m.state,ubicacion:m.municipality||"",descripcion:m.novelty_description||"",mt:m.mt??"",fecha_inicio:m.novelty_start?String(m.novelty_start).slice(0,10):"",fecha_fin:m.novelty_end?String(m.novelty_end).slice(0,10):""})),e=we.json_to_sheet(l),t=we.book_new();we.book_append_sheet(t,e,"Detalle");const n=xt(t,{bookType:"xlsx",type:"array"});Lt.saveAs(new Blob([n],{type:"application/octet-stream"}),`detalle_${q.value.groupCode}_${q.value.date}.xlsx`)}Nt(async()=>{ve.value=!0,await Ze(),await r();const l=d.query.groupId?String(d.query.groupId):I.value&&a.value[0]?String(a.value[0].id):"all";b.value=l;try{const e=String(d.query.date||""),t=String(d.query.unitId||"");C.value=e||me.value,T.value=t,!d.query.groupId&&!("unitId"in d.query)&&await u.replace({name:d.name,params:d.params,query:{...d.query,date:C.value,unitId:""}}),await ie(C.value),T.value&&C.value?await ae(C.value,T.value):R.value&&$.value?await ee(C.value,$.value):Ve.value?(await fe(Ve.value),q.value={...q.value,date:C.value}):await ne(C.value),I.value&&a.value.length&&(b.value=String(a.value[0].id))}catch{w.value=!1}finally{ve.value=!1}}),J(()=>d.params.id,async(l,e)=>{if(l&&l!==e){w.value=!1,M.value=[];try{await fe(String(l))}finally{w.value=!0}}}),J(T,async(l,e)=>{l!==e&&await Te()}),J(b,async(l,e)=>{l!==e&&(await u.replace({name:d.name,params:d.params,query:{...d.query,groupId:l==="all"?void 0:l,unitId:""}}),await ie(C.value),l!=="all"?($e.value=!1,await ee(C.value,l)):await ne(C.value))});const G=O({open:!1,agent:null}),Z=O("calendar"),de=O([]),_=O(new Date);function W(l){return l.toISOString().slice(0,10)}function Ce(l){const e=new Date(l);return e.setDate(1),e.setHours(0,0,0,0),e}function Ee(l){const e=new Date(l);return e.setMonth(e.getMonth()+1,0),e.setHours(0,0,0,0),e}function De(l,e){const t=new Date(l);return t.setMonth(t.getMonth()+e),t}function nt(l){return new Intl.DateTimeFormat("es-CO",{month:"long",year:"numeric"}).format(l)}function Ue(l){const e=new Date(l);e.setHours(0,0,0,0);const t=(e.getDay()+6)%7;return e.setDate(e.getDate()-t),e}function Pe(l){const e=new Date(l);e.setHours(0,0,0,0);const t=(e.getDay()+6)%7;return e.setDate(e.getDate()+(6-t)),e}const ot=D(()=>W(Ue(Ce(De(_.value,-2))))),rt=D(()=>W(Pe(Ee(_.value)))),qe=D(()=>Ue(Ce(_.value))),Fe=D(()=>Pe(Ee(_.value))),ut=D(()=>nt(_.value)),dt=D(()=>W(qe.value)),pt=D(()=>W(Fe.value));function ct(){_.value=De(_.value,-1),ce()}function ht(){_.value=De(_.value,1),ce()}function mt(){_.value=new Date((C.value||Q())+"T00:00:00"),ce()}function Ae(l){const e=String(l||"").toUpperCase();return{"SIN NOVEDAD":"‚úÖ",SERVICIO:"üß≠","COMISI√ìN DEL SERVICIO":"üìå","FRANCO FRANCO":"üõå",VACACIONES:"üèñÔ∏è","LICENCIA DE MATERNIDAD":"üë∂","LICENCIA DE LUTO":"üïäÔ∏è","LICENCIA REMUNERADA":"üìù","LICENCIA NO REMUNERADA":"üìù","EXCUSA DEL SERVICIO":"üìù","LICENCIA PATERNIDAD":"üçº",PERMISO:"‚è≥","DESCANSO ESPECIAL":"üéÜ","PERMISO ACTIVIDAD PERSONAL":"‚è≥","COMISI√ìN EN EL EXTERIOR":"‚úàÔ∏è","COMISI√ìN DE ESTUDIO":"üéì",SUSPENDIDO:"‚õî",HOSPITALIZADO:"üè•"}[e]||"‚Ä¢"}function pe(l){const e=String(l||"").toUpperCase();return{"SIN NOVEDAD":{bg:"bg-emerald-100",pill:"bg-emerald-100 text-emerald-800",dot:"bg-emerald-500"},SERVICIO:{bg:"bg-sky-100",pill:"bg-sky-100 text-sky-800",dot:"bg-sky-500"},"COMISI√ìN DEL SERVICIO":{bg:"bg-indigo-100",pill:"bg-indigo-100 text-indigo-800",dot:"bg-indigo-500"},"FRANCO FRANCO":{bg:"bg-gray-100",pill:"bg-gray-100 text-gray-800",dot:"bg-gray-500"},VACACIONES:{bg:"bg-amber-100",pill:"bg-amber-100 text-amber-800",dot:"bg-amber-500"},SUSPENDIDO:{bg:"bg-rose-100",pill:"bg-rose-100 text-rose-800",dot:"bg-rose-500"},HOSPITALIZADO:{bg:"bg-rose-100",pill:"bg-rose-100 text-rose-800",dot:"bg-rose-500"}}[e]||{bg:"bg-slate-100",pill:"bg-slate-100 text-slate-700",dot:"bg-slate-400"}}function He(l){return l=String(l||""),l.length<=16?l:l.slice(0,16)+"‚Ä¶"}const vt=["SIN NOVEDAD","SERVICIO","COMISI√ìN DEL SERVICIO","VACACIONES","FRANCO FRANCO","SUSPENDIDO","HOSPITALIZADO"];async function gt(l){const e=l.agentId??l.id;e&&(G.value={open:!0,agent:{id:e,code:l.code,nickname:l.nickname}},Z.value="calendar",_.value=new Date((C.value||Q())+"T00:00:00"),await ce())}async function ce(){if(G.value.agent)try{const{data:l}=await V.get(`/admin/agents/${G.value.agent.id}/history`,{params:{from:ot.value,to:rt.value},headers:{Authorization:"Bearer "+localStorage.getItem("token")}});de.value=Array.isArray(l?.items)?l.items:[]}catch(l){console.warn("No se pudo cargar historial:",l?.response?.data?.error||l.message),de.value=[]}}const ft=D(()=>{const l=qe.value,e=Fe.value,t=new Map(de.value.map(o=>[String(o.date),o])),n=[],m=Ce(_.value),g=Ee(_.value);for(let o=new Date(l);o<=e;o.setDate(o.getDate()+1)){const f=W(o),S=t.get(f),te=S?.state||null,bt=te?`${f} ‚Äî ${te}${S?.municipalityName?" ‚Äî "+S.municipalityName:""}`:f,It=f===W(new Date),St=o<m||o>g;n.push({key:f,day:o.getDate(),state:te,title:bt,isToday:It,isPadding:St})}return n}),yt=D(()=>{const l=[...de.value].sort((t,n)=>String(t.date).localeCompare(String(n.date))),e=[];for(const t of l){const n=t.state||"SIN NOVEDAD",m=String(n).toUpperCase()==="COMISI√ìN DEL SERVICIO",g=m?t.municipalityName||"‚Äî":null,o=m?`${n}::${g}`:n,f=e[e.length-1];f&&f.key===o?(f.to=t.date,f.count+=1):e.push({key:o,state:n,municipalityName:g,from:t.date,to:t.date,count:1})}return e});return(l,e)=>(p(),c(x,null,[i("div",es,[i("div",ts,[i("div",ss,[i("div",ls,[e[20]||(e[20]=i("div",{class:"w-9 h-9 rounded-xl bg-gradient-to-br from-slate-800 to-slate-700 grid place-items-center text-white font-bold"},"N",-1)),i("div",null,[i("h2",is,v(R.value?"Detalle de reporte del grupo":"Detalle de reporte de unidad"),1),e[19]||(e[19]=i("p",{class:"text-slate-500 text-xs"},"Detalle de las novedades del personal",-1))])]),i("button",{onClick:e[0]||(e[0]=t=>ze(u).back()),class:"btn-ghost"},"Volver")])]),i("main",as,[ve.value?(p(),c("div",ns,"Cargando...")):w.value?(p(),c(x,{key:2},[i("div",rs,[i("div",us,[i("div",null,[e[21]||(e[21]=i("label",{class:"label"},"Fecha",-1)),N(i("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),class:"input",onChange:Xe},null,544),[[X,C.value]])]),i("div",null,[e[22]||(e[22]=i("label",{class:"label"},"Grupo",-1)),N(i("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),class:"input",disabled:I.value},[I.value?y("",!0):(p(),c("option",ps,"Todos")),(p(!0),c(x,null,F(a.value,t=>(p(),c("option",{key:t.id,value:String(t.id)},v(t.code)+" ("+v(t.name)+") ",9,cs))),128))],8,ds),[[se,b.value]])]),i("div",hs,[e[24]||(e[24]=i("label",{class:"label"},"Unidad",-1)),N(i("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t),class:"input",onChange:Te},[e[23]||(e[23]=i("option",{value:""},"Todas las unidades‚Ä¶",-1)),(p(!0),c(x,null,F(z.value,t=>(p(),c("option",{key:t.id,value:String(t.id)},v(t.name),9,ms))),128))],544),[[se,T.value]]),z.value.length?y("",!0):(p(),c("p",vs," No hay unidades para la fecha seleccionada. "))])])]),i("div",gs,[i("div",fs,[i("div",ys,[i("div",null,[e[25]||(e[25]=i("label",{class:"label"},"B√∫squeda",-1)),N(i("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>k.value.q=t),class:"input",placeholder:"C√≥digo o texto‚Ä¶"},null,512),[[X,k.value.q]])]),i("div",null,[e[27]||(e[27]=i("label",{class:"label"},"Categor√≠a",-1)),N(i("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>k.value.category=t),class:"input"},e[26]||(e[26]=[i("option",{value:"ALL"},"Todas",-1),i("option",{value:"OF"},"OF",-1),i("option",{value:"SO"},"ME",-1),i("option",{value:"PT"},"PT",-1)]),512),[[se,k.value.category]])]),i("div",null,[e[29]||(e[29]=i("label",{class:"label"},"Estado",-1)),N(i("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>k.value.state=t),class:"input"},[e[28]||(e[28]=i("option",{value:"ALL"},"Todos",-1)),(p(),c(x,null,F(Me,t=>i("option",{key:t,value:t},v(t),9,bs)),64))],512),[[se,k.value.state]])]),i("div",Is,[N(i("input",{id:"solo-nov",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>k.value.onlyNovelties=t),class:"h-4 w-4"},null,512),[[wt,k.value.onlyNovelties]]),e[30]||(e[30]=i("label",{class:"label cursor-pointer",for:"solo-nov"},"Solo novedades",-1))]),i("div",{class:"flex gap-2"},[i("button",{class:"flex-1 sm:flex-none inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700",onClick:at},"Descargar")])]),i("div",Ss,[(p(!0),c(x,null,F(et.value,t=>(p(),c("span",{key:t.key,class:B(["inline-flex items-center gap-2 px-3 py-1 rounded-full border text-sm",t.cls])},[i("span",{class:B(["inline-block w-2.5 h-2.5 rounded-full",t.dot])},null,2),U(" "+v(t.label)+": ",1),i("b",null,v(t.count),1)],2))),128))])])]),i("div",Os,[i("div",Cs,[i("table",Es,[i("thead",null,[i("tr",null,[e[31]||(e[31]=i("th",null,"C√≥digo",-1)),e[32]||(e[32]=i("th",null,"Agente",-1)),e[33]||(e[33]=i("th",null,"Cat",-1)),R.value?(p(),c("th",Ds,"Grupo")):y("",!0),R.value?(p(),c("th",As,"Unidad")):y("",!0),e[34]||(e[34]=i("th",null,"Novedad",-1)),e[35]||(e[35]=i("th",null,"Ubicaci√≥n",-1)),e[36]||(e[36]=i("th",null,"Descripci√≥n",-1)),e[37]||(e[37]=i("th",null,"Misi√≥n",-1)),e[38]||(e[38]=i("th",null,"Inicio - Fin",-1)),e[39]||(e[39]=i("th",null,"D√≠as Lab",-1)),e[40]||(e[40]=i("th",null,"Historial",-1)),Y.value?(p(),c("th",Ns,"Acciones")):y("",!0)])]),i("tbody",null,[(p(!0),c(x,null,F(oe.value,t=>(p(),c("tr",{key:t._key},[i("td",ws,v(t.code),1),i("td",null,v(t.nickname||"‚Äî"),1),i("td",null,v(Ye(t.category)),1),R.value?(p(),c("td",ks,[i("span",xs,v(t.groupCode||"‚Äî"),1)])):y("",!0),R.value?(p(),c("td",Ls,[i("span",Vs,v(t.unitName||"‚Äî"),1)])):y("",!0),i("td",null,[i("span",{class:B(["inline-flex px-2 py-0.5 rounded-full text-xs font-semibold border",Qe(t.state)])},v(We(t.state)),3)]),i("td",null,v(t.municipality||"N/A"),1),i("td",null,v(t.novelty_description||"‚Äî"),1),i("td",null,[i("div",{class:"line-clamp-1 max-w-[180px] text-slate-800 text-sm cursor-help",title:t.mt||"‚Äî"},v(t.mt||"‚Äî"),9,$s)]),i("td",null,[t.novelty_start&&t.novelty_end?(p(),c(x,{key:0},[U(v(ge(t.novelty_start))+" ‚Äì "+v(ge(t.novelty_end)),1)],64)):t.novelty_start?(p(),c(x,{key:1},[U(v(ge(t.novelty_start)),1)],64)):(p(),c("span",Rs,"‚Äî"))]),i("td",null,[i("span",{class:B(["inline-block min-w-[2.5em] text-center rounded px-1",t.diasLaborados>=45?"bg-red-100 text-red-600 font-bold border border-red-200":t.diasLaborados>=30?"bg-orange-100 text-orange-700 font-semibold border border-orange-200":t.diasLaborados>0?"bg-green-50 text-green-700 font-semibold border border-green-200":"text-slate-400 border border-slate-200 bg-white"]),title:t.diasLaborados>=45?"¬°Alerta! tiempo prolongado sin descanso ":t.diasLaborados>=30?"Atenci√≥n: M√°s de un mes sin descansar":t.diasLaborados>0?"D√≠as consecutivos en servicio o sin novedad":"Sin d√≠as laborados"},v(t.diasLaborados??0),11,Ms)]),Y.value?(p(),c("td",Ts,[i("button",{class:"btn-ghost p-1",title:"Historial",onClick:n=>gt(t)},e[41]||(e[41]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[i("path",{d:"M12 8v4l3 3"}),i("circle",{cx:"12",cy:"12",r:"9"})],-1)]),8,_s)])):y("",!0),Y.value?(p(),c("td",Bs,[i("button",{class:"btn-ghost p-1",title:"Editar",onClick:n=>st(t)},e[42]||(e[42]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("path",{d:"M18 2a2.828 2.828 0 0 1 4 4L7 21l-4 1 1-4Z"}),i("path",{d:"m16 5 3 3"})],-1)]),8,Us)])):y("",!0)]))),128)),oe.value.length?y("",!0):(p(),c("tr",Ps,[i("td",{colspan:R.value?Y.value?14:13:Y.value?12:11,class:"text-center text-slate-500 py-6"}," Sin agentes ",8,qs)]))])])])]),be.value?(p(),c("div",{key:0,class:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center p-4",onClick:E(ue,["self"])},[i("div",Fs,[i("div",Hs,[i("div",Gs," Editar agente ‚Äî "+v(j.value?.code),1),i("button",{class:"btn-ghost",onClick:ue},"Cerrar")]),i("div",zs,[i("div",js,[i("div",null,[e[43]||(e[43]=i("label",{class:"label"},"Estado",-1)),N(i("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>h.value.state=t),class:"input"},[(p(),c(x,null,F(Me,t=>i("option",{key:t,value:t},v(t),9,Ks)),64))],512),[[se,h.value.state]])]),tt.value?(p(),c("div",Zs,[e[45]||(e[45]=i("label",{class:"label"},"Municipio",-1)),Le(ze(Ke),{modelValue:h.value.municipio,"onUpdate:modelValue":e[9]||(e[9]=t=>h.value.municipio=t),options:K.value,loading:Se.value,"internal-search":!1,"clear-on-select":!0,"close-on-select":!0,"preserve-search":!0,"show-labels":!1,"allow-empty":!0,placeholder:"Escribe para buscar‚Ä¶",label:"label","track-by":"id",onSearchChange:lt,class:"w-full"},{noResult:le(()=>e[44]||(e[44]=[U("Ning√∫n municipio encontrado",-1)])),option:le(({option:t})=>[i("div",Xs,[i("span",null,v(t.label),1),i("span",Ys,"id: "+v(t.id),1)])]),singleLabel:le(({option:t})=>[i("span",null,v(t.label),1)]),_:1},8,["modelValue","options","loading"]),e[46]||(e[46]=i("div",{class:"text-xs text-slate-500 mt-1"},null,-1))])):y("",!0),Ie.value?(p(),c("div",Qs,[e[47]||(e[47]=i("label",{class:"label"},"Inicio",-1)),N(i("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>h.value.novelty_start=t),type:"date",class:"input"},null,512),[[X,h.value.novelty_start]])])):y("",!0),Ie.value?(p(),c("div",Ws,[e[48]||(e[48]=i("label",{class:"label"},"Fin",-1)),N(i("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>h.value.novelty_end=t),type:"date",class:"input"},null,512),[[X,h.value.novelty_end]])])):h.value.state==="HOSPITALIZADO"?(p(),c("div",Js,[e[49]||(e[49]=i("label",{class:"label"},"Inicio",-1)),N(i("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>h.value.novelty_start=t),type:"date",class:"input"},null,512),[[X,h.value.novelty_start]])])):y("",!0),i("div",null,[e[50]||(e[50]=i("label",{class:"label"},"MT",-1)),N(i("input",{"onUpdate:modelValue":e[13]||(e[13]=t=>h.value.mt=t),type:"text",class:"input",placeholder:"MT"},null,512),[[X,h.value.mt]]),e[51]||(e[51]=i("p",{class:"text-[11px] text-slate-500 mt-1"},"Campo libre (opcional).",-1))]),_e.value?(p(),c("div",el,[e[52]||(e[52]=i("label",{class:"label"},"Descripci√≥n",-1)),N(i("textarea",{"onUpdate:modelValue":e[14]||(e[14]=t=>h.value.novelty_description=t),class:"input",rows:"2",placeholder:"Motivo / detalle..."},null,512),[[X,h.value.novelty_description]])])):y("",!0),h.value.state==="SERVICIO"?(p(),c("div",tl," Para ‚ÄúSERVICIO‚Äù el municipio se fija autom√°ticamente en Bogot√° (11001). ")):y("",!0)]),i("div",sl,[i("button",{class:"btn-ghost",onClick:ue},"Cancelar"),i("button",{class:"btn-primary",onClick:it,disabled:re.value},v(re.value?"Guardando...":"Guardar"),9,ll)])])])])):y("",!0)],64)):(p(),c("div",os,"No se encontr√≥ informaci√≥n para esta fecha!"))])]),G.value.open?(p(),c("div",il,[i("div",{class:"absolute inset-0 bg-black/40",onClick:e[15]||(e[15]=t=>G.value.open=!1)}),i("div",al,[i("div",nl,[i("div",ol,[i("div",rl,[U(" Historial ‚Äî "+v(G.value.agent?.code)+" ",1),G.value.agent?.nickname?(p(),c("span",ul,"("+v(G.value.agent.nickname)+")",1)):y("",!0)]),i("span",dl,v(ut.value),1)]),i("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm font-medium text-white hover:bg-white/10",onClick:e[16]||(e[16]=t=>G.value.open=!1)},"‚úï")]),i("div",pl,[i("div",cl,[i("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:ct},"‚óÄ"),i("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:mt},"Hoy"),i("button",{class:"inline-flex items-center justify-center rounded-lg px-3 py-2 text-sm bg-white border border-slate-300 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:hover:bg-slate-700",onClick:ht},"‚ñ∂"),i("span",hl,v(dt.value)+" ‚Üí "+v(pt.value),1)]),i("div",ml,[i("button",{class:B(["px-3 py-1.5 text-sm rounded-full",Z.value==="calendar"?"bg-white shadow-sm text-slate-900 dark:bg-slate-900 dark:text-white":"text-slate-700 dark:text-slate-200"]),onClick:e[17]||(e[17]=t=>Z.value="calendar")},"Calendario",2),i("button",{class:B(["px-3 py-1.5 text-sm rounded-full",Z.value==="timeline"?"bg-white shadow-sm text-slate-900 dark:bg-slate-900 dark:text-white":"text-slate-700 dark:text-slate-200"]),onClick:e[18]||(e[18]=t=>Z.value="timeline")},"L√≠nea de tiempo",2)])]),i("div",vl,[Z.value==="calendar"?(p(),c("div",gl,[e[53]||(e[53]=kt('<div class="grid grid-cols-7 gap-2 text-xs font-medium text-slate-600 mb-1" data-v-d64a8935><div class="text-center" data-v-d64a8935>L</div><div class="text-center" data-v-d64a8935>M</div><div class="text-center" data-v-d64a8935>X</div><div class="text-center" data-v-d64a8935>J</div><div class="text-center" data-v-d64a8935>V</div><div class="text-center" data-v-d64a8935>S</div><div class="text-center" data-v-d64a8935>D</div></div>',1)),i("div",fl,[(p(!0),c(x,null,F(ft.value,t=>(p(),c("div",{key:t.key,title:t.title,class:B(["h-20 rounded-xl p-2 flex flex-col transition-all border border-slate-200 dark:border-slate-700 hover:shadow-md hover:-translate-y-[1px]",[t.state?pe(t.state)?.bg||"bg-slate-100":"bg-white dark:bg-slate-400/60",t.isToday&&"ring-2 ring-blue-500/70",t.isPadding&&"opacity-60"]])},[i("div",bl,v(t.day||""),1),t.state?(p(),c("div",Il,v(Ae(t.state)),1)):y("",!0),t.state?(p(),c("div",Sl,v(He(t.state)),1)):y("",!0)],10,yl))),128))])])):(p(),c("div",Ol,[e[54]||(e[54]=i("div",{class:"absolute left-3 top-0 bottom-0 w-px bg-gradient-to-b from-slate-300 via-slate-200 to-slate-300 dark:from-slate-700 dark:via-slate-800 dark:to-slate-700"},null,-1)),(p(!0),c(x,null,F(yt.value,(t,n)=>(p(),c("div",{key:n,class:"flex items-center gap-3 pl-4"},[i("div",{class:B(["w-3 h-3 rounded-full border-2 border-white shadow ring-1 ring-slate-200 dark:border-slate-900",pe(t.state)?.dot||"bg-slate-400"])},null,2),i("div",{class:B(["inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs shadow-sm",pe(t.state)?.pill||"bg-slate-100 text-slate-700"])},[U(v(Ae(t.state))+" ",1),i("span",null,[U(v(t.state)+" ",1),t.municipalityName?(p(),c(x,{key:0},[U(" ‚Äî üìç "+v(t.municipalityName),1)],64)):y("",!0)]),i("span",Cl,"("+v(t.from)+" ‚Üí "+v(t.to)+")",1),i("span",El,"‚Ä¢ "+v(t.count)+" d√≠a(s)",1)],2)]))),128))])),Z.value==="calendar"?(p(),c("div",Dl,[(p(),c(x,null,F(vt,t=>i("div",{key:t,class:B(["inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs shadow-sm",pe(t)?.pill||"bg-slate-100 text-slate-700"])},v(Ae(t))+" "+v(He(t)),3)),64))])):y("",!0)])])])):y("",!0)],64))}},kl=Et(Al,[["__scopeId","data-v-d64a8935"]]);export{kl as default};
